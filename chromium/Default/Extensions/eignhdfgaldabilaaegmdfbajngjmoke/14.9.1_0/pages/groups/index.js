cjModules.define(function(){"use strict";return function(e,n){function t(){var e=cjMaterial.createElement("drawer",{color:"#4285f4"}),n=bmElements.createElement("servicelogo",{label:cjExtensions.i18n("cj_i18n_00418","Groups"),color:"#4285f4"});return e.appendChild(n),e.tabs=bmElements.createElement("drawertabs",{items:x,onChange:function(e){var n=x[e];n.external===!0&&bmBasics.openTab(n.newTabUrl),E.textContent="",C.textContent=n.label,n.init()},selected:"my"}),e.appendChild(e.tabs),e}function r(e){e&&bmBasics.openTab(w+"#!search/"+e)}function a(){var e=cjMaterial.createElement("appbar",{color:"#4285f4",secondary:!0}),n=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){v.open()}});return e.appendChild(n),C=cjMaterial.createElement("title",{label:cjExtensions.i18n("cj_i18n_00388","My groups")}),e.appendChild(C),e}function o(e){var n,t,r=JSON.parse(e.replace(/\\/g,"").replace(/'/g,'"').replace("//OK",""));for(t=r.length-1;t>-1;t--)if(Array.isArray(r[t])){n=r[t];break}var a=[];for(t=0;t<n.length;t++)-1!==n[t].indexOf("@googlegroups.com")&&a.push({id:n[t].split("@googlegroups.com")[0],name:n[t-1]});return a}function i(e,n){return cjBasics.ajax({type:"POST",url:"https://groups.google.com/forum/tree?appversion=1&hl=en&authuser="+g.account.authuser,data:"7|3|6|https://groups.google.com/forum/|"+n+"|4w|"+e+"|_|getNavTreeContents|1|2|3|4|5|6|0|",requestHeaders:{"content-type":"text/x-gwt-rpc; charset=UTF-8","x-gwt-module-base":"","x-gwt-permutation":""}}).then(function(e){return e.startsWith("//OK")?e:Promise.reject()})}function c(e,n){var t=e.xrsfToken,r=e.strongNames,a=n||0;return r.length===a?Promise.reject():i(t,r[a])["catch"](function(){return c(e,a+1)})}function s(){return T().then(c).then(o)}function u(e,n){return cjBasics.ajax({type:"POST",url:"https://groups.google.com/forum/rel_content?appversion=1&hl=en&authuser="+g.account.authuser,data:"7|3|6|https://groups.google.com/forum/|"+n+"|5i|"+e+"|_|getForumsAndDomains|1|2|3|4|5|6|0|",requestHeaders:{"content-type":"text/x-gwt-rpc; charset=UTF-8","x-gwt-module-base":"","x-gwt-permutation":""}}).then(function(e){return e.startsWith("//OK")?e:Promise.reject()})}function l(e,n){var t=e.xrsfToken,r=e.strongNames,a=n||0;return r.length===a?Promise.reject():u(t,r[a])["catch"](function(){return l(e,a+1)})}function m(){return T().then(l).then(o).then(function(e){return g.cache.set("bm__cache__groups__groups",e),e})}function p(){return g.cache.get("bm__cache__groups__groups").then(function(e){return Array.isArray(e)?e:[]})}function d(e){var n=cjMaterial.createElement("item");n.addEventListener("click",function(){bmBasics.openTab(w+"#!forum/"+e.id)});var t=cjMaterial.createElement("icon",{name:"__mdi:forum",color:"#4285f4"});n.appendChild(t);var r=document.createElement("div");r.className="cj-md-item__body",n.appendChild(r);var a=document.createElement("div");a.className="cj-md-item__header",a.textContent=e.name,r.appendChild(a);var o=document.createElement("div");return o.className="cj-md-secondarytext",o.textContent=e.id,r.appendChild(o),n}function f(n,t){if(E.textContent="",Array.isArray(n)&&n.length>0)n.forEach(function(e){var n=d(e);E.appendChild(n)});else{var r=cjExtensions.i18n("cj_i18n_00386","No groups found");"recent"===t&&(r=cjExtensions.i18n("cj_i18n_00387","No recent groups found"));var a=cjMaterial.createElement("emptystate",{color:"#4285f4",label:r,subLabel:cjExtensions.i18n("cj_i18n_00383","To add a new group, click the add button"),iconName:"__mdi:forum"});E.appendChild(a)}"cache"!==t&&bmBasics.toggleLoading("off",e)}function h(){E.textContent="";var e=cjMaterial.createElement("emptystate",{color:"#4285f4",label:cjExtensions.i18n("cj_i18n_00384","Couldn't load your groups"),subLabel:cjExtensions.i18n("cj_i18n_00385","If you think this is an error, please report it to the developer of the extension"),iconName:"__mdi:forum"});E.appendChild(e)}function _(n){return bmBasics.toggleLoading("on",e),(n?p:m)().then(function(e){f(e,n&&"cache")},h)}function b(){bmBasics.toggleLoading("on",e),s().then(function(e){f(e,"recent")},h)}function j(){bmBasics.toggleLoading("on",e),x={my:{label:cjExtensions.i18n("cj_i18n_00388","My groups"),iconName:"__mdi:forum",init:function(){_(!0).then(function(){bmBasics.toggleLoading("off",e)})},newTabUrl:w+"#!myforums"},recent:{label:cjExtensions.i18n("cj_i18n_00389","Recently viewed"),iconName:"__mdi:history",init:b},starred:{label:cjExtensions.i18n("cj_i18n_00004","Starred"),iconName:"__mdi:star",newTabUrl:w+"#!starred",external:!0},settings:{label:cjExtensions.i18n("cj_i18n_00298","Settings"),iconName:"__mdi:settings",newTabUrl:w+"#!usersettings/general",external:!0}},v=t();var n=bmElements.createElement("pageheader",{color:"#4285f4",pageId:"groups",searchboxProperties:{onSubmit:r,submitInNewTab:!0}}),o=a(),i=cjMaterial.createElement("fab",{label:cjExtensions.i18n("cj_i18n_00392","Create new group"),iconName:"__mdi:add",onClick:function(){bmBasics.openTab(w+"#!creategroup")}});e.appendChild(i),E=cjMaterial.createElement("container",{scrollable:!0,shadow:!0}),e.appendChild(n),y(n.searchbox.select),e.appendChild(o),e.appendChild(E),e.appendChild(v),_(!0),_()}var x,E,v,C,y=n.onPageDisplay,w="https://groups.google.com/forum/?authuser="+g.account.authuser,T=function(){function e(){return cjBasics.ajax({url:w}).then(function(e){return{xrsfToken:e.split('xsrf-token":"')[1].split('"')[0],gwtPermutation:e.split('src="/forum/')[1].split(".")[0]}})}function n(e){return cjBasics.ajax({url:"https://groups.google.com/forum/"+e+".cache.js"}).then(function(e){return e.split(/\(\);[a-zA-Z]{1,4}\.call\(this,[a-zA-Z]{1,4}\(\),'([0-9a-zA-Z]{32})/).filter(function(e,n){return n%2})})}var t;return function(){return t||(t=e().then(function(e){return n(e.gwtPermutation).then(function(n){return{xrsfToken:e.xrsfToken,strongNames:n}})})),t}}();j()}});