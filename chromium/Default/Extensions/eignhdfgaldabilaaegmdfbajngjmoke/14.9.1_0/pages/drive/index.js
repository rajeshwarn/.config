cjModules.define(function(){"use strict";return function(e,i){function o(){return"shared-with-me"===A?"shared-with-me":"recent"===A?"recent":"photos"===A?"photos":"trashed"===A?"trash":"starred"===A?"starred":"my-drive"===A?"my-drive":"folder"===A?"folders/"+z.id:"search"===A?"search?q="+encodeURIComponent(M.searchbox.value):""}function n(){if("shared-with-me"===A)return{q:"trashed = false and not 'me' in owners and sharedWithMe",orderBy:"sharedWithMeTime desc",spaces:"drive,photos"};if("recent"===A)return{q:"(not mimeType = 'application/vnd.google-apps.folder') and trashed = false",orderBy:"recency desc",spaces:"drive,photos"};if("photos"===A)return{q:"(not mimeType = 'application/vnd.google-apps.folder') and trashed = false and 'me' in owners",orderBy:"createdTime desc",spaces:"photos",hideLabels:!0,listview:!1};var e=H.selected;if("trashed"===A)return{q:"trashed = true and explicitlyTrashed = true",orderBy:"folder,"+e,spaces:"drive,photos"};if("starred"===A)return{q:"trashed = false and starred = true",orderBy:"folder,"+e,spaces:"drive,photos"};if("my-drive"===A)return{q:"trashed = false and 'root' in parents",orderBy:"folder,"+e,spaces:"drive,photos"};if("folder"===A)return{q:"trashed = false and '"+z.id+"' in parents",orderBy:"folder,"+e,spaces:"drive,photos",subHeaderColor:z.color};if("search"===A){var i=M.searchbox.value,o=["trashed = false"],n=i;if(-1!==i.indexOf("type:")){n="";var a=i.split("type:")[1];-1!==i.indexOf(" ")&&(n=i.split(" ")[1],a=a.split(" ")[0]);var t=ie[a];o.push(t)}return o.push("fullText contains '"+n+"'"),{q:o.join(" and "),spaces:"drive,photos"}}return null}function a(){w.textContent="";var i=n();Q.then(function(){bmBasics.toggleLoading("off",e);var o=gDoclist.create({subHeaderColor:i.subHeaderColor||F,listview:"boolean"==typeof i.listview?i.listview:q,onFileClick:c,searching:"search"===A,cachingId:"my-drive"===A||"recent"===A?"bm__cache__drive__doclist":null,spaces:i.spaces,orderBy:i.orderBy,hideLabels:i.hideLabels,q:i.q});w.appendChild(o)})}function t(i){for(var o=e.querySelectorAll("div:not(.bm-ele-fulldialog) > .cj-md-appbar"),n=cjColors.getContrastColor(cjColors.hexToRgb(i)),a=0;a<o.length;a++)o[a].style.backgroundColor=i,o[a].classList.toggle("cj-md--dark",n);var t=e.querySelector(".fab-placeholder");t.style.color="#fff"===i?F:i,t.classList.toggle("cj-md--dark",n)}function r(i,o){bmBasics.toggleLoading("on",e);var n=te[i];if(n&&n.page)return bmRuntime.changeToPage(n.page),void(B.selected=A);D=A,A=i,S=z,z=o,B.selected=i,"folder"!==A&&t(I),n?k.textContent=n.label:"folder"===A?(k.textContent="",s(z),t(z.color||I)):"search"===A&&(k.textContent="Search"),C.updateIcon({iconName:"search"===A?"__mdi:arrow_back":"__mdi:menu"});var r=-1===J.indexOf(i);V.style.display=r?"none":"";var c="photos"===i;L.style.display=c?"none":"",a();var l="recent"===i;(l||"my-drive"===i)&&cjExtensions.settings.set("prefDriveUseRecent",l)}function c(e){if("application/vnd.google-apps.folder"===e.mimeType){var i=e.folderColorRgb;"#8f8f8f"===i&&(i=null),r("folder",{id:e.id,color:i})}else{var o=e.webViewLink;cjBasics.urls.insertParameter(o,"authuser",g.account.authuser),bmBasics.openTab(o)}}function s(e){g.request({scope:K,url:cjBasics.urls.create(W+"files/"+e.id,{fields:"name,parents"}),dataType:"JSON"}).then(function(i){var o=document.createElement("span");o.textContent=i.name;var n=k.querySelector("span");if(n){var a=document.createTextNode(" > ");o.addEventListener("click",function(){n.firstChild===o?r("my-drive"):r("folder",e)});var t=n.firstChild;n.insertBefore(a,t),n.insertBefore(o,a)}else n=document.createElement("span"),k.appendChild(n),n.appendChild(o);"parents"in i&&s({id:i.parents[0]})})}function l(){var e=cjMaterial.createElement("drawer",{color:F}),i=bmElements.createElement("servicelogo",{label:cjExtensions.i18n("cj_i18n_00390","Drive"),color:F});return e.appendChild(i),B=bmElements.createElement("drawertabs",{items:te,onChange:r,selected:A}),e.appendChild(B),e}function p(){var e=document.createDocumentFragment();return ae.forEach(function(i){var o=cjMaterial.createElement("item");o.addEventListener("click",function(){M.searchmenu.hide();var e=M.searchbox.value;-1!==e.indexOf("type:")&&(e=e.split(" ")[1]),M.searchbox.value="type:"+i.value+(e?" "+e:""),"search"===A?a():r("search")});var n=cjMaterial.createElement("icon",{name:i.iconName,color:i.color});o.appendChild(n);var t=document.createElement("div");t.textContent=i.label,o.appendChild(t),e.appendChild(o)}),e}function d(e){var i=e,o=i.split("#");i=o[0];var n=o[1];-1===i.indexOf("authuser")&&(i+=-1===i.indexOf("?")?"?":"&",i+="authuser="+g.account.authuser),"folder"===A&&z&&(i+=-1===i.indexOf("?")?"?":"&",i+="folder="+z.id),n&&(i+="#"+n),bmBasics.openTab(i)}function m(e){var i=document.createElement("div");return i.className="new-file-container bm-ele-shortcutlist bm-ele-shortcutlist--with-borders",i.addEventListener("click",function(){E.close()}),e.forEach(function(e){e.onClick||(e.onClick=function(){d(e.url)});var o=cjMaterial.createElement("item");if(e.id&&(o.dataset.id=e.id),e.onClick&&o.addEventListener("click",e.onClick),e.icon||e.iconName){var n=cjMaterial.createElement("icon",{serviceName:e.iconName||e.icon.name||"placeholder"});o.appendChild(n)}var a=document.createElement("div");a.className="cj-md-item__body",a.textContent=e.label,o.appendChild(a),i.appendChild(o)}),i}function u(){return g.request({internal:!0,url:"https://www.googleapis.com/drive/v2/apps",scope:K,dataType:"JSON"}).then(function(e){var i=[];return e.items.filter(function(e){return e.supportsCreate&&-1===$.indexOf(e.id)}).forEach(function(e){var o,n=e.name,a=e.createUrl+(-1!==e.createUrl.indexOf("?")?"&":"?")+"authuser="+g.account.authuser,t=cjBasics.isRetina?64:32;e.icons.forEach(function(e){e.size===t&&"application"===e.category&&(o=e.iconUrl)}),o||(o="images/"+t+"/undefined-"+t+".png"),i.push({label:n,url:a,icon:{url:o,size:32}})}),i}).then(function(e){return g.cache.set("bm__cache__drive__apps",e),e})}function h(){return g.cache.get("bm__cache__drive__apps").then(function(e){return Array.isArray(e)&&e.length>0?e:u()})}function v(){if(E)E.open();else{E=cjMaterial.createElement("bottomsheet");var i=cjMaterial.createElement("subheader",{label:cjExtensions.i18n("cj_i18n_00143","More")});E.appendChild(i);var o=m(re);E.appendChild(o),h().then(function(e){E.removeChild(o);var i=Array.isArray(e)?re.concat(e):re,n=m(i);E.appendChild(n)}),e.appendChild(E),setTimeout(E.open,100)}}function f(e){return new Promise(function(i,o){var n=new FileReader;n.readAsBinaryString(e),n.addEventListener("load",function(){i(n.result)}),n.addEventListener("error",function(){o()})})}function _(e){return f(e).then(function(i){var o=btoa(i),n=e.type||"application/octet-stream",a={name:e.name,mimeType:n},t=[Y,"Content-Type: application/json\r\n\r\n",JSON.stringify(a),Y,"Content-Type: ",n,"\r\n","Content-Transfer-Encoding: base64\r\n","\r\n",o,Z].join("");return g.request({scope:K,url:"https://www.googleapis.com/upload/drive/v2/files?uploadType=multipart",type:"POST",requestHeaders:{"Content-Type":'multipart/mixed; boundary="'+X+'"'},data:t})})}function y(){return bmElements.createElement("pageheader",{color:I,pageId:"drive",light:P,searchboxProperties:{onSubmit:function(){"search"!==A?r("search"):a()},onSubmitAlt:function(e){var i=cjBasics.urls.create(G+"search",{q:e});bmBasics.openTab(i)}},includeSearchMenu:!0})}function b(e){var i,o=e.id,n=e.label,a=ne[o].color,t=ne[o].name;return i="function"==typeof oe[o]?oe[o]:function(){d(oe[o])},cjMaterial.createElement("fab",{mini:!0,label:n,color:a,iconName:t,onClick:i})}function T(e){var i=cjMaterial.createElement("appbar",{color:I,secondary:!0,light:P});return C=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){"search"===A?(M.searchbox.value="",C.updateIcon({iconName:"__mdi:menu"}),r(D,S)):N.open()}}),i.appendChild(C),k=cjMaterial.createElement("title",{label:te[A].label}),i.appendChild(k),H=bmElements.createElement("dropdown",{selected:e.prefDriveOrderBy||"name",onChange:function(e){a(),H.close(),cjExtensions.settings.set("prefDriveOrderBy",e)},items:ee}),V=cjMaterial.createElement("iconbutton",{label:cjExtensions.i18n("cj_i18n_00096","Order by"),iconName:"__mdi:cj_sort_by_alpha",onClick:function(){H.open()}}),i.appendChild(V),V.addEventListener("click",function(e){e.stopPropagation()}),i.appendChild(H),L=cjMaterial.createElement("iconbutton",{label:cjExtensions.i18n("cj_i18n_00106","Change view"),iconName:q?"__mdi:view_module":"__mdi:view_list",onClick:function(){q=!q,L.updateIcon({iconName:q?"__mdi:view_module":"__mdi:view_list"}),cjExtensions.settings.set("prefDriveThumbnailView",!q),a()}}),i.appendChild(L),i}function j(){var i=document.createElement("input");return i.type="file",i.multiple=!0,i.style.display="none",i.addEventListener("change",function(){bmBasics.toggleLoading("on",e);for(var o=[],n=0;n<i.files.length;n++)o.push(_(i.files[n]));Promise.all(o).then(function(){bmBasics.toggleLoading("off",e)})}),i}function x(){bmBasics.toggleLoading("on",e),O=j(),e.appendChild(O),M=y(),e.appendChild(M);var i=p();cjExtensions.settings.get(["prefDriveThumbnailView","prefDriveUseRecent","prefDriveOrderBy"]).then(function(o){o.prefDriveUseRecent&&(A="recent"),q=!o.prefDriveThumbnailView,N=l(),e.appendChild(N);var n=T({prefDriveOrderBy:o.prefDriveOrderBy});e.appendChild(n);var t=document.createElement("div");t.className="fab-container";var r=[{id:"document",label:cjExtensions.i18n("cj_i18n_00145","Document")},{id:"spreadsheet",label:cjExtensions.i18n("cj_i18n_00146","Spreadsheet")},{id:"presentation",label:cjExtensions.i18n("cj_i18n_00147","Presentation")},{id:"upload",label:cjExtensions.i18n("cj_i18n_00148","Upload")}];r.forEach(function(e){var i=b(e);t.appendChild(i)});var c=cjMaterial.createElement("fab",{label:cjExtensions.i18n("cj_i18n_00091","More"),color:"#e5e5e5",iconName:"__mdi:add",onClick:v});c.classList.add("fab-overflow"),t.appendChild(c);var s=cjMaterial.createElement("fab",{color:F,label:cjExtensions.i18n("cj_i18n_00090","New file"),iconName:"__mdi:add",isPlaceholder:!0});s.classList.add("fab-placeholder"),t.appendChild(s),e.appendChild(t),w=cjMaterial.createElement("container",{shadow:!0}),M.searchmenu.appendChild(i);var p=cjMaterial.createElement("iconbutton",{iconName:"__mdi:arrow_drop_down",onClick:M.searchmenu.toggle});M.searchbox.appendChild(p),e.appendChild(w),U(M.searchbox.select),a()}),g.auth.getAccessToken(K)["catch"](function(i){var o=bmElements.createElement("fulldialog",{serviceLogo:{label:cjExtensions.i18n("cj_i18n_00390","Drive")},iconName:"drive",message:cjExtensions.i18n("cj_i18n_00089","Before you can use this page, you need to give the extension access to Google Drive"),actionLabel:cjExtensions.i18n("cj_i18n_00224","Give permission"),action:i.authorize});e.appendChild(o)})}var E,w,C,N,B,M,k,L,D,z,S,q,O,U=i.onPageDisplay,P=!0,F=P?"#4285f4":"#2196F3",I=P?"#fff":F,A="my-drive",R=Math.round(document.documentElement.offsetHeight*document.documentElement.offsetWidth/7500);20>R&&(R=20);var G="https://drive.google.com/drive/u/"+g.account.authuser+"/";i.setOpenInNewHandler(function(){var e=G+o();bmBasics.openTab(e)});var H,V,J=["trashed","starred","my-drive","folder"],W="https://www.googleapis.com/drive/v3/",K=["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.photos.readonly","https://www.googleapis.com/auth/drive.apps.readonly"],Q=Promise.all([cjBasics.loadStyleFile("stylesheets/g-doclist.css"),cjBasics.loadScriptFile("scripts/g-doclist.js")]),X="-------314159265358979323846",Y="\r\n--"+X+"\r\n",Z="\r\n--"+X+"--",$=["889782162350","619683526622","952342923413","196802322321","796396377186","1083656409722"],ee=[{id:"name",label:cjExtensions.i18n("cj_i18n_00092","Name")},{id:"modifiedTime desc",label:cjExtensions.i18n("cj_i18n_00093","Last modified")},{id:"modifiedByMeTime desc",label:cjExtensions.i18n("cj_i18n_00094","Last modified by me")},{id:"viewedByMeTime desc",label:cjExtensions.i18n("cj_i18n_00095","Last opened by me")}],ie={archive:"(mimeType = 'application/bzip2' or mimeType = 'application/gzip' or mimeType = 'application/gzip-compressed' or mimeType = 'application/gzipped' or mimeType = 'application/rar' or mimeType = 'application/tar' or mimeType = 'application/x-bzip' or mimeType = 'application/x-bzip-compressed-tar' or mimeType = 'application/x-bzip2' or mimeType = 'application/x-gtar' or mimeType = 'application/x-gtar-compressed' or mimeType = 'application/x-gunzip' or mimeType = 'application/x-gzip' or mimeType = 'application/x-gzip-compressed' or mimeType = 'application/x-rar' or mimeType = 'application/x-tar' or mimeType = 'application/x-tgz' or mimeType = 'application/x-zip' or mimeType = 'application/x-zip-compressed' or mimeType = 'application/zip' or mimeType = 'gzip/document' or mimeType = 'multipart/x-gzip' or mimeType = 'multipart/x-rar' or mimeType = 'multipart/x-tar' or mimeType = 'multipart/x-zip' or mimeType = 'multipart/zip')",audio:"(mimeType = 'audio/3gp' or mimeType = 'audio/midi' or mimeType = 'audio/mp4a-latm' or mimeType = 'audio/mpeg' or mimeType = 'audio/mpeg3' or mimeType = 'audio/ogg' or mimeType = 'audio/x-ms-wma' or mimeType = 'audio/x-wav' or mimeType = 'audio/wav')",document:"(mimeType = 'application/msword' or mimeType = 'application/vnd.google-apps.document' or mimeType = 'application/vnd.google-apps.kix' or mimeType = 'application/vnd.ms-word' or mimeType = 'application/vnd.oasis.opendocument.text' or mimeType = 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' or mimeType = 'text/plain')",drawing:"(mimeType = 'application/vnd.oasis.opendocument.graphics' or mimeType = 'image/vnd.adobe.photoshop' or mimeType = 'image/x-photoshop' or mimeType = 'application/illustrator' or mimeType = 'application/vnd.google-apps.drawing')",folder:"(mimeType = 'application/vnd.google-apps.folder')",form:"(mimeType = 'application/vnd.google-apps.form' or mimeType = 'application/vnd.google-apps.freebird')",image:"(mimeType = 'image/jpeg' or mimeType = 'image/png' or mimeType = 'image/gif' or mimeType = 'image/tiff' or mimeType = 'image/x-ms-bmp' or mimeType = 'image/svg+xml' or mimeType = 'image/vnd.microsoft.icon')",pdf:"(mimeType = 'application/pdf')",presentation:"(mimeType = 'application/mspowerpoint' or mimeType = 'application/vnd.ms-powerpoint' or mimeType = 'application/vnd.oasis.opendocument.presentation' or mimeType = 'application/vnd.openxmlformats-officedocument.presentationml.presentation' or mimeType = 'application/vnd.google-apps.presentation' or mimeType = 'application/vnd.google-apps.punch')",spreadsheet:"(mimeType = 'application/msexcel' or mimeType = 'application/vnd.google-apps.form' or mimeType = 'application/vnd.google-apps.freebird' or mimeType = 'application/vnd.google-apps.ritz' or mimeType = 'application/vnd.google-apps.spreadsheet' or mimeType = 'application/vnd.ms-excel' or mimeType = 'application/vnd.oasis.opendocument.spreadsheet' or mimeType = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet')",video:"(mimeType = 'video/3gpp' or mimeType = 'video/avi' or mimeType = 'video/dv' or mimeType = 'video/flv' or mimeType = 'video/mp2p' or mimeType = 'video/mp2t' or mimeType = 'video/mp4' or mimeType = 'video/mpeg' or mimeType = 'video/mpv' or mimeType = 'video/ogg' or mimeType = 'video/quicktime' or mimeType = 'video/x-flv' or mimeType = 'video/x-msvideo' or mimeType = 'video/x-ms-wmv' or mimeType = 'video/x-m4v' or mimeType = 'video/x-ms-asf' or mimeType = 'video/x-matroska' or mimeType = 'video/x-dv' or mimeType = 'video/webm')"},oe={upload:function(){O.click()},document:"https://docs.google.com/document/create?authuser="+g.account.authuser,spreadsheet:"https://docs.google.com/spreadsheets/create?authuser="+g.account.authuser,presentation:"https://docs.google.com/presentation/create?authuser="+g.account.authuser,drawing:"https://docs.google.com/drawings/create?authuser="+g.account.authuser,form:"https://docs.google.com/forms/create?authuser="+g.account.authuser,script:"https://script.google.com/create?authuser="+g.account.authuser,table:"https://www.google.com/fusiontables/DataSource?dsrcid=implicit&authuser="+g.account.authuser,map:"https://www.google.com/maps/d/u/"+g.account.authuser+"/drive?state=%7B%22action%22%3A%22create%22%7D"},ne={document:{name:"__mdi:drive_document",color:"#4285f4"},spreadsheet:{name:"__mdi:drive_spreadsheet",color:"#34a853"},presentation:{name:"__mdi:drive_presentation",color:"#ffcd40"},upload:{name:"__mdi:file_upload",color:"#b3b3b3"}},ae=[{iconName:"__mdi:drive_pdf",color:"#ea4335",value:"pdf",label:cjExtensions.i18n("cj_i18n_00137","PDFs")},{iconName:"__mdi:drive_document",color:"#4285f4",value:"document",label:cjExtensions.i18n("cj_i18n_00138","Text documents")},{iconName:"__mdi:drive_spreadsheet",color:"#34a853",value:"spreadsheet",label:cjExtensions.i18n("cj_i18n_00139","Spreadsheets")},{iconName:"__mdi:drive_presentation",color:"#FFCD40",value:"presentation",label:cjExtensions.i18n("cj_i18n_00140","Presentations")},{iconName:"__mdi:drive_image",color:"#ea4335",value:"image",label:cjExtensions.i18n("cj_i18n_00141","Photos & images")},{iconName:"__mdi:drive_video",color:"#ea4335",value:"video",label:cjExtensions.i18n("cj_i18n_00142","Videos")}],te={"my-drive":{label:cjExtensions.i18n("cj_i18n_00001","My Drive"),iconName:"__mdi:cj_my_drive",newTabUrl:G+"my-drive"},"shared-with-me":{label:cjExtensions.i18n("cj_i18n_00002","Shared with me"),iconName:"__mdi:people",newTabUrl:G+"shared-with-me"},photos:{label:cjExtensions.i18n("cj_i18n_00088","Google Photos"),iconName:"__mdi:photos",newTabUrl:G+"photos"},recent:{label:cjExtensions.i18n("cj_i18n_00003","Recent"),iconName:"__mdi:schedule",newTabUrl:G+"recent"},starred:{label:cjExtensions.i18n("cj_i18n_00004","Starred"),iconName:"__mdi:star",newTabUrl:G+"starred"},trashed:{label:cjExtensions.i18n("cj_i18n_00005","Trash"),iconName:"__mdi:delete",newTabUrl:G+"trash",divider:!0},docs:{label:cjExtensions.i18n("cj_i18n_00391","Docs"),iconName:"__mdi:drive_document",color:"#4285f4",colorIcon:!0,newTabUrl:"https://docs.google.com/document/u/"+g.account.authuser+"/",page:"docs"},sheets:{label:cjExtensions.i18n("cj_i18n_00393","Sheets"),iconName:"__mdi:drive_spreadsheet",color:"#34a853",colorIcon:!0,newTabUrl:"https://docs.google.com/spreadsheets/u/"+g.account.authuser+"/",page:"sheets"},slides:{label:cjExtensions.i18n("cj_i18n_00407","Slides"),iconName:"__mdi:drive_presentation",color:"#ffcd40",colorIcon:!0,newTabUrl:"https://docs.google.com/presentation/u/"+g.account.authuser+"/",page:"slides"},forms:{label:cjExtensions.i18n("cj_i18n_00408","Forms"),iconName:"__mdi:drive_form",color:"#673ab7",colorIcon:!0,newTabUrl:"https://docs.google.com/forms/u/"+g.account.authuser+"/",page:"forms",divider:!0},storage:{label:cjExtensions.i18n("cj_i18n_00077","Upgrade storage"),iconName:"__mdi:storage",onClick:function(){bmBasics.openTab("https://www.google.com/settings/storage?authuser="+g.account.authuser)}}},re=[{label:"Google "+cjExtensions.i18n("cj_i18n_00409","Drawings"),url:oe.drawing,iconName:"drawings"},{label:"Google "+cjExtensions.i18n("cj_i18n_00408","Forms"),url:oe.form,iconName:"forms"},{label:"Google "+cjExtensions.i18n("cj_i18n_00446","Fusion Tables"),url:oe.table,iconName:"fusion_tables"},{label:"Google "+cjExtensions.i18n("cj_i18n_00447","Apps Script"),url:oe.script,iconName:"script"},{label:"Google "+cjExtensions.i18n("cj_i18n_00410","My Maps"),url:oe.map,iconName:"my_maps"}];x()}});