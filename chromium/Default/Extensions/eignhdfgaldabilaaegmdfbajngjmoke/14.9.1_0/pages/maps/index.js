cjModules.define(function(){"use strict";return function(e,t){function a(e){e&&v.setPosition(e),v.setVisible(Boolean(e))}function n(e){return cjBasics.ajax({dataType:"JSON",url:"https://maps.googleapis.com/maps/api/place/textsearch/json?key="+g.key+"&query="+encodeURIComponent(e)}).then(function(e){if("OK"===e.status){var t=e.results[0];if(t.geometry){var a=t.geometry.viewport;return t.geometry.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(a.southwest.lat,a.southwest.lng),new google.maps.LatLng(a.northeast.lat,a.northeast.lng)),delete t.geometry.viewport,t}}return Promise.reject(e.status)})}function i(e){return cjBasics.ajax({dataType:"JSON",url:"https://maps.googleapis.com/maps/api/place/details/json?key="+g.key+"&placeid="+e}).then(function(e){return"OK"===e.status?e.results:Promise.reject(e.status)})}function o(e){e.geometry.viewport?h.fitBounds(e.geometry.viewport):(h.setCenter(e.geometry.location),h.setZoom(17)),_.setBounds(h.getBounds()),h.panBy(0,-80)}function s(e){u.textContent="";var t=cjMaterial.createElement("title",{label:e.placeName});if(u.appendChild(t),e.address&&e.address.length>0){var a=cjMaterial.createElement("secondarytext");a.innerHTML=e.address,u.appendChild(a)}if(e.transitContainer){var n=document.createElement("div");n.className="gm-style",n.appendChild(e.transitContainer),u.appendChild(n)}y=e.mapsUrl,y||i(e.placeId).then(function(e){y=e.url});var o=cjMaterial.createElement("button",{color:"#4285f4",label:cjExtensions.i18n("cj_i18n_00124","View on Google Maps"),onClick:function(){bmBasics.openTab(y)}});u.appendChild(o);var s=cjMaterial.createElement("fab",{iconName:"__mdi:directions",onClick:function(){bmBasics.openTab(e.directionsUrl)}});u.appendChild(s),u.classList.add("bm-p-maps__results--visible")}function r(e){j&&T[j].layer.setMap(null),j=e;var t=T[e];if(t){if(!t.loaded){t.loaded=!0;var a=t.layerName;a&&(t.layer=new google.maps[a])}t.layer.setMap(h)}}function l(){var e=cjMaterial.createElement("drawer",{color:"#4285f4"}),t=bmElements.createElement("servicelogo",{label:cjExtensions.i18n("cj_i18n_00423","Maps"),color:"#4285f4"});e.appendChild(t);var a=bmElements.createElement("drawertabs",{items:T,onChange:r,onActiveClick:function(){a.selected=null,r(null)}});e.appendChild(a);var n={hybrid:{iconName:"__mdi:satellite",label:cjExtensions.i18n("cj_i18n_00125","Satellite")},terrain:{iconName:"__mdi:terrain",label:cjExtensions.i18n("cj_i18n_00126","Terrain"),divider:!0},places:{label:cjExtensions.i18n("cj_i18n_00127","Your places"),newTabUrl:w+"@37.0625,-95.677068,4z/data=!4m2!10m1!1e2?authuser="+g.account.authuser,iconName:"__mdi:place",external:!0},contributions:{label:cjExtensions.i18n("cj_i18n_00128","Your contributions"),newTabUrl:w+"contrib/?authuser="+g.account.authuser,iconName:"__mdi:rate_review",external:!0},timeline:{label:cjExtensions.i18n("cj_i18n_00129","Your timeline"),newTabUrl:w+"timeline?authuser="+g.account.authuser,iconName:"__mdi:timeline",external:!0}};return f=bmElements.createElement("drawertabs",{items:n,onChange:function(e){n[e].external?bmBasics.openTab(n[e].newTabUrl):h.setMapTypeId(e)},onActiveClick:function(){h.setMapTypeId("roadmap"),f.selected=null}}),e.appendChild(f),e}function c(){v.setVisible(!1)}function p(e){e.geometry.location?a(e.geometry.location):c(),o(e);var t=e.name||e.address_components[0].short_name;s({placeId:e.place_id,placeName:t,address:e.formatted_address,mapsUrl:e.url?cjBasics.urls.insertParameter(e.url,"authuser",g.account.authuser):null,directionsUrl:cjBasics.urls.create(w,{daddr:t.split(" ").join("+"),authuser:g.account.authuser})})}function m(){c(),u.classList.remove("bm-p-maps__results--visible")}function d(){bmBasics.toggleLoading("on",e);var t=l();e.appendChild(t);var i=cjMaterial.createElement("appbar",{floating:!0,light:!0}),o=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){t.open()}});i.appendChild(o),b=bmElements.createElement("searchbox",{raised:!0,onClear:m,onSubmitAlt:function(e){var t=cjBasics.urls.create(w,{q:e,authuser:g.account.authuser});bmBasics.openTab(t)}}),C(b.select),i.appendChild(b),u=cjMaterial.createElement("card",{withPadding:!0}),u.classList.add("bm-p-maps__results"),b.appendChild(u);var r=bmElements.createElement("maintoolbarbuttons","maps");i.appendChild(r),e.appendChild(i);var c=cjMaterial.createElement("card");c.classList.add("bm-p-maps__maptype"),c.dataset.satelliteText=cjExtensions.i18n("cj_i18n_00289","Satellite"),c.dataset.mapText=cjExtensions.i18n("cj_i18n_00290","Map"),c.addEventListener("click",function(){var e="hybrid"===h.mapTypeId;h.setMapTypeId(e?"roadmap":"hybrid")}),e.appendChild(c);var d=cjMaterial.createElement("container");d.classList.add("bm-p-maps__map"),e.appendChild(d),E.then(function(){h=new google.maps.Map(d,{clickableIcons:!0,panControl:!1,center:new google.maps.LatLng(10,0),minZoom:1,zoom:1,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.ZoomControlStyle.SMALL},styles:[{featureType:"administrative",elementType:"geometry.fill",stylers:[{visibility:"off"}]}]}),h.panBy(0,-32),cjBasics.loadScriptFile("https://www.google.com/jsapi").then(function(){var t=google.loader.ClientLocation;t?(h.setCenter({lat:t.latitude,lng:t.longitude}),h.setZoom(6),_.setBounds(h.getBounds())):e.classList.add("bm-p-maps--large-zoom")});var t=h.getStreetView();google.maps.event.addListener(t,"visible_changed",function(){e.classList.toggle("streetview",t.getVisible())}),v=new google.maps.Marker({map:h,visible:!1}),google.maps.InfoWindow.prototype.setPosition=a,google.maps.InfoWindow.prototype.setContent=function(e){this.setMap(null);var t=e.querySelector(".title").textContent;b.value=t;var a=e.querySelector(".view-link a").href;a=cjBasics.urls.insertParameter(a,"authuser",g.account.authuser);var n=e.querySelector(".transit-container");if(n){var i=n.querySelector(".transit-title:not([style]) span");n.removeChild(i.parentNode),t=i.textContent}s({placeName:t,address:e.querySelector(".address").innerHTML,transitContainer:n,mapsUrl:a,directionsUrl:cjBasics.urls.insertParameter(a,"daddr",t.split(" ").join("+"))})},google.maps.InfoWindow.prototype.open=function(){},h.addListener("maptypeid_changed",function(){var t="hybrid"===h.mapTypeId;f.selected=h.mapTypeId,e.classList.toggle("satellite",t)}),h.addListener("zoom_changed",function(){e.classList.toggle("bm-p-maps--large-zoom",1===h.zoom)}),_=new google.maps.places.Autocomplete(b.inputElement),_.bindTo("bounds",h),google.maps.event.addListener(_,"place_changed",function(){var e=_.getPlace();e.geometry?p(e):n(b.value).then(p),b.blur()}),bmBasics.toggleLoading("off",e)})}var u,b,f,y,h,_,v,j,C=t.onPageDisplay,w="https://www.google.com/maps/";t.setOpenInNewHandler(function(){var e=w+"?authuser="+g.account.authuser;y&&v.getVisible()&&(e=y),bmBasics.openTab(e)});var T={traffic:{iconName:"__mdi:traffic",label:cjExtensions.i18n("cj_i18n_00032","Traffic"),layerName:"TrafficLayer"},transit:{iconName:"__mdi:directions_transit",label:cjExtensions.i18n("cj_i18n_00033","Public Transport"),layerName:"TransitLayer"},bicycling:{iconName:"__mdi:directions_bike",label:cjExtensions.i18n("cj_i18n_00034","Cycling"),layerName:"BicyclingLayer"}},E=new Promise(function(e){var t="mapsPageApiCallback";window[t]=function(){delete window[t],e()};var a=cjBasics.urls.create("https://maps.googleapis.com/maps/api/js",{key:g.key,callback:t,libraries:"places",language:g.lang});cjBasics.loadScriptFile(a)});d()}});