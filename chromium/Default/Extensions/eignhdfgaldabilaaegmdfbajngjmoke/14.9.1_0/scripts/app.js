!function(){"use strict";function e(e){C.then(function(){e(E)})}function n(e){E=e,cjExtensions.settings.set("selected-services",e)}function t(e){E=E.concat(e),cjExtensions.settings.set("selected-services",E)}function a(e){var n=cjMaterial.createElement("container");return n.classList.add("bm-p-"+e),n.dataset.id=e,n.addEventListener("mouseenter",function(){bmAnalytics.push(["_trackEvent","Page Mouseenter",e])}),n}function i(e){return"gplus"===e.id?{label:"+"}:"gmail"===e.id?{labelPrefix:"",label:"Gmail"}:"youtube"===e.id?{labelPrefix:"",label:"YouTube"}:"chromeapps"===e.id||"chrometopsites"===e.id?{labelPrefix:"",label:e.label}:{label:e.label}}function o(e){var n=e.serviceData;if(!x){var t=bmElements.createElement("pageheader",{pageTitle:n.label});n.body.appendChild(t)}var a=bmElements.createElement("fulldialog",{serviceLogo:{label:i(n)},iconName:n.iconName,message:e.message,actionLabel:e.actionLabel,action:e.action});n.body.appendChild(a)}function s(e){var n=h[e];n.body=a(e),!j&&x||!n.popup||(n.body.classList.add("bm-page--popup"),n.body.addEventListener("click",function(e){e.stopPropagation()})),b.appendChild(n.body);var t;if(n.onPageDisplay=new Promise(function(e){t=e}),!n.loaded){n.loaded=!0;var i=[cjModules.require("/pages/"+e+"/index"),g.initialized];n.extraCss&&i.push(cjBasics.loadStyleFile("pages/"+e+"/index.css")),Promise.all(i).then(function(e){return!g.signedIn&&n.requireSignin?void o({serviceData:n,message:"To use Google "+n.label+",<br>sign in to your Google Account",actionLabel:"Sign in",action:g.accounts.add}):"none"===g.account.pageid||n.gplusPages?void e[0](n.body,{onPageDisplay:t,setOpenInNewHandler:function(e){n.openInNewCallback=e}}):void o({serviceData:n,message:"This service doesn't support Brand Accounts,<br>Switch to a non-page account",actionLabel:"Switch account",action:function(){c("account")}})})}}function c(e){document.documentElement.classList.remove("portal-expanded");var n=b.querySelector(".bm-page--popup.on");n&&n.classList.remove("on");var t=h[e];t.loaded||s(e),!j&&x||!t.popup?(k=b.selected||k,b.selected=e,dispatchEvent(w),t.onPageDisplay.then(function(n){e===b.selected&&setTimeout(n)})):t.body.classList.add("on")}function d(){b=document.createElement("div"),b.className="main-window",b.addEventListener("click",function(){var e=b.querySelector(".bm-page--popup.on");e&&e.classList.remove("on")}),cjBasics.makeSelector(b),document.body.appendChild(b)}function r(e){"youtube"===e.id&&g.signedIn&&(e.url="https://www.youtube.com/signin?next=https%3A%2F%2Fwww.youtube.com%2F&authuser=[authuser]&pageid=[pageid]"),bmBasics.openTab(e.url.replace("[authuser]",g.account.authuser).replace("[pageid]",g.account.pageid)),bmAnalytics.push(["_trackEvent","Open service in new tab",e.id])}function l(e){if(document.body.createTextRange){var n=document.body.createTextRange();return n.moveToElementText(e),void n.select()}if(window.getSelection){var t=window.getSelection(),a=document.createRange();a.selectNodeContents(e),t.removeAllRanges(),t.addRange(a)}}function u(e){var n=h[e],t=cjMaterial.createElement("item",{icon:{serviceName:n.iconName},label:n.label});n.menuItem=t,t.classList.add("page-menu-item"),t.dataset.id=e,"none"===g.account.pageid&&bmRuntime.portalOnSide&&(t.draggable=!0,cjBasics.isVivaldi&&t.addEventListener("mousedown",function(){l(document.body)}),t.addEventListener("dragstart",function(n){t.parentNode===bmRuntime.portalPageServicesList&&f.classList.add("on"),n.dataTransfer.setData("serviceId",e)})),t.addEventListener("touchstart",function(n){n.preventDefault(),n.stopPropagation(),c(e)});var a=cjMaterial.createElement("iconbutton",{iconName:"__mdi:open_in_new",label:cjExtensions.i18n("cj_i18n_00084","Open service in new tab"),onClick:function(e){r(n),e.stopPropagation()}});return a.classList.add("page-menu-item--open-in-new"),t.appendChild(a),t.addEventListener("click",function(n){if(t.parentNode===bmRuntime.portalPageServicesList)c(e);else if(t.parentNode===bmRuntime.customizePageServicesList){bmRuntime.addSelectedServices(e);var a=h.customize&&h.customize.menuItem;bmRuntime.portalPageServicesList.insertBefore(bmRuntime.servicePageData[e].menuItem,a)}else setTimeout(function(){c(e)},300);n.stopPropagation()}),t}function m(){var e=document.createElement("div");e.className="portal-sidebar bm-p-portal",e.addEventListener("click",function(){var e=b.querySelector(".bm-page--popup.on");e&&e.classList.remove("on")}),document.body.appendChild(e),Promise.all([cjBasics.loadStyleFile("pages/portal/index.css"),cjModules.require("/pages/portal/index")]).then(function(n){e.textContent="",n[1](e)})}function p(){f=document.createElement("div"),f.className="remove-page",f.dataset.label=cjExtensions.i18n("cj_i18n_00097","Drop here to remove"),f.addEventListener("drop",function(t){t.preventDefault(),f.classList.remove("on");var a=t.dataTransfer.getData("serviceId"),i=h[a].menuItem;bmRuntime.customizePageServicesList?bmRuntime.customizePageServicesList.appendChild(i):i.parentNode.removeChild(i),e(function(e){var t=e.indexOf(a);e.splice(t,1),n(e)})}),f.addEventListener("dragover",function(e){e.preventDefault()}),b.appendChild(f),window.addEventListener("dragleave",function(e){0===e.y&&f.classList.remove("on")})}function v(){function a(){document.documentElement.classList.toggle("mac-popup-fix"),i>0&&(setTimeout(a,o),i-=o)}if(cjBasics.isMac){var i=1250,o=250;a()}else cjBasics.loadStyleFile("stylesheets/scrollbar.css");chrome.tabs.getCurrent(function(e){if("undefined"!=typeof e){var n=e.id;window.addEventListener("beforeunload",function(){chrome.runtime.sendMessage({removeAllowedTabId:n})}),chrome.runtime.sendMessage({addAllowedTabId:n})}}),document.body.addEventListener("click",function(e){if(e.target===document.body){var n=b.querySelector(".bm-page--popup.on");n&&n.classList.remove("on")}}),window.bmRuntime={runningInExtensionPopup:P,runningInOptionsPage:S,runningInNewtabPage:j,portalOnSide:x,standaloneService:y,changeToPage:c,changeToPreviousPage:function(){c(k)},createMenuItem:u,getSelectedServices:e,setSelectedServices:n,addSelectedServices:t,requirePages:T,xFrameOptionsSupported:!0},Object.defineProperty(window.bmRuntime,"servicePageData",{get:function(){return h}}),P&&document.documentElement.classList.add("extension-popup"),j&&document.documentElement.classList.add("is-new-tab"),S&&document.documentElement.classList.add("options-popup"),P&&y&&"portal"!==y&&document.documentElement.classList.add("single-popup"),g.initialized.then(function(){document.documentElement.classList.toggle("gauth-gplus-pages","none"!==g.account.pageid)}),d(),x?(e(function(e){var n=e[0];c(n||"customize")}),document.documentElement.classList.add("portal-on-side"),m(),p()):T.then(function(){c(y)}),bmAnalytics.init(),g.init({key:"AIzaSyBoU4_PBKEtA-GJp5z55vwkv5qMAbhgOlo",clientId:"494086030851-93vje778kogr9dnfq2hhli2e918p4hha.apps.googleusercontent.com",lang:cjBasics.lang}),cjExtensions.settings.get("dense-mode").then(function(e){e===!0&&document.documentElement.classList.add("is-dense-mode")}),window.addEventListener("message",function(e){var n=e.data.blackMenuOpenUrl;n&&bmBasics.openTab(n)})}var b,f,h,E,L=cjBasics.urls.getParameters(),w=new CustomEvent("bm-page-change"),y=L.page,P="1"===L.popup,S="1"===L.options,j="1"===L.newtab,x=!y,k=y||"search",T=cjBasics.ajax({url:"pages.json",dataType:"JSON"}).then(function(e){Object.keys(e).forEach(function(n){e[n].labelI18n&&(e[n].label=cjExtensions.i18n(e[n].labelI18n,e[n].label))}),h=e}),I=cjExtensions.settings.get("selected-services"),C=Promise.all([g.initialized,T]).then(function(){var e=Object.keys(h);return"none"!==g.account.pageid?e.filter(function(e){return h[e].gplusPages}):I.then(function(e){return Array.isArray(e)?e:j?["chromtopsites","chromebookmarks","calendar","keep","news","drive","gmail","tasks","maps","contacts"]:cjBasics.isFirefox?["search","maps","youtube","news","gmail","drive","calendar","keep","contacts"]:["search","gplus","translate","maps","youtube","news","gmail","drive","calendar","keep"]}).then(function(n){return n.filter(function(n){return-1!==e.indexOf(n)})})}).then(function(e){E=e});j?window.addEventListener("DOMContentLoaded",v):window.addEventListener("load",function(){setTimeout(v)})}();