!function(){"use strict";function e(e){return new Promise(function(t){Array.isArray(e)?ne.storage.local.get(e,function(e){t(JSON.parse(JSON.stringify(e)))}):ne.storage.local.get(e,function(n){t(JSON.parse(JSON.stringify(n))[e])})})}function t(e){ne.tabs.create({url:e})}function n(){return Q.userid+"-"+Q.pageid}function r(e,t){var n=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(t));return new Promise(function(e){var t={};"string"==typeof n?t[n]=r:t=n,ne.storage.local.set(JSON.parse(JSON.stringify(t)),e)})}function o(e){return new Promise(function(t){ne.storage.local.remove(e,t)})}function i(t){return e(n()+"-"+t)}function a(e,t){return r(n()+"-"+e,t)}function s(e){return o(n()+"-"+e)}function u(e){return new Promise(function(t,n){var r=new XMLHttpRequest;return r.open(e.type||"GET",e.url),r.addEventListener("load",function(){if(200===r.status){if("TEXT"===e.dataType||"string"!=typeof e.dataType)return void t(r.responseText);if("XML"===e.dataType)return void t(r.responseXML);"JSON"===e.dataType&&t(JSON.parse(r.responseText))}else n({error:r.status,body:r.responseText})}),r.addEventListener("error",n),e.requestHeaders&&Object.keys(e.requestHeaders).forEach(function(t){var n=e.requestHeaders[t];null!==n&&"undefined"!=typeof n&&r.setRequestHeader(t,n)}),"JSON"===e.dataType&&r.overrideMimeType("application/json"),r.send(e.data),r})}function c(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split(""),n="",r=0;e>r;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function d(e){var t=[];for(var n in e)null!==e[n]&&"undefined"!=typeof e[n]&&"undefined"!==e[n]&&t.push(n+"="+encodeURIComponent(e[n]));return 0===t.length?"":"?"+t.join("&")}function p(e,t){return e+d(t)}function l(e,t,n){for(var r=e;r.indexOf(t)>-1;)r=r.replace(t,n);return r}function f(e){if("string"!=typeof e)return null;var t=e;t.startsWith("http:")&&(t=t.replace("http:","https:")),t.startsWith("//")&&(t=t.replace("//","https://")),t.startsWith("https://")||(t="https://"+t);var n=t.split("/");return n.pop(),n.pop(),t=n.join("/")+"/mo/"}function h(e){return e[1].map(function(e){var t=e[7].toString(),n=e[10],r=null!==e[8]&&21===e[8].length?e[8]:"none",o=[t,n,r].join("-");return{key:o,authuser:t,userid:n,pageid:r,email:e[3],name:e[2],photo:f(e[4])}})}function w(){return u({url:"https://accounts.google.com/ListAccounts?listPages=1&json=standard&origin=https%3A%2F%2Fwww.google.com"}).then(function(e){var t=e;return t=l(t,"\\x","%"),t=decodeURIComponent(t),t=t.substring(t.indexOf("[")),t=t.split("]"),t.pop(),t=t.join("]")+"]",t=JSON.parse(t),h(t)})}function m(){return z({originRequest:!0,url:"https://accounts.google.com/ListAccounts?listPages=1&json=standard&source=ChromiumBrowser",type:"POST",dataType:"JSON",withCredentials:!0}).then(h)}function y(){return u({url:"https://www.google.com/?gws_rd=cr&authuser=0"}).then(function(e){var t=[];try{var n=e.split('href="https://www.google.com/webhp?authuser=');if(n[1])for(var r=1;r<n.length;r++){var o=n[r],i=o.split('"')[0],a="1",s="none",u=[i,a,s].join("-");t.push({key:u,authuser:i,photo:f(o.split('data-src="')[1].split('"')[0]),name:o.split('">')[4].split("<")[0],email:o.split('">')[5].split("<")[0].split(" ")[0],pageid:s,userid:a})}}catch(c){}return t})}function v(){return e("g-accounts-list").then(function(e){return Array.isArray(e)?e:[]})}function O(){return Y||(Y=w()["catch"](m)["catch"](y).then(function(e){return e},function(){return[]}).then(function(e){return r("g-accounts-list",e),e})),Y}function q(e){return e?v():O()}function T(e){Q=e,r("g-accounts-current",e),location.reload()}function S(){t("https://accounts.google.com/addsession?continue=https%3A%2F%2Fwww.google.com%2Fg-api%2Fsignin"),window.close()}function P(){t("https://accounts.google.com/logout?continue=https%3A%2F%2Fwww.google.com%2Fg-api%2Fsignout"),window.close()}function A(){return e("g-accounts-current").then(function(e){return e&&e.key?(Q=e,void O().then(function(e){var t=!1;e.forEach(function(e){Q.key===e.key&&(t=!0)}),t===!1&&(0===e.length?(o("g-accounts-current"),location.reload()):T(e[0]))})):O().then(function(e){0===e.length?Q={authuser:"0",pageid:"none"}:T(e[0])})})}function k(e){return de?pe:(de=!0,K=e.clientId,G=e.key,e.lang&&(ue=e.lang),window.___gcfg={lang:ue,parsetags:"explicit"},Z(),A().then(function(){U="none"===Q.pageid?ie:ae,g.clientId=K,g.key=G,g.lang=ue,g.account=Q,g.signedIn=Q.hasOwnProperty("key"),V()}),pe)}function x(e){return u({url:p("https://www.googleapis.com/oauth2/v3/tokeninfo",{access_token:e.access_token,fields:"aud,scope,exp",prettyPrint:!1}),dataType:"JSON"})}function N(){return ee||(ee=new Promise(function(e,t){var n=document.createElement("script");n.src="https://apis.google.com/js/api.js",n.async=!0,n.addEventListener("load",function(){e(window.gapi)}),n.addEventListener("error",function(){t()}),document.head.appendChild(n)})),ee}function J(e){return ce[e]||(ce[e]=N().then(function(t){return new Promise(function(n){t.load(e,n)})})),ce[e]}function C(e){return le.then(function(){if(Array.isArray(e)){var t=e.map(function(e){return J(e)});return Promise.all(t)}return J(e)})}function j(e,t,n){var r=!1,o=e;return-1!==o.indexOf("#")&&(r=o.split("#")[1],o=o.split("#")[0]),o+=-1===o.indexOf("?")?"?":"&",o+=t+"="+encodeURIComponent(n),r!==!1&&(o+="#"+r),o}function E(){return $||($=new Promise(function(e){function t(r){r.data.gApiRequestReady&&e(n),window.removeEventListener("message",t)}var n=document.createElement("iframe");n.src="https://www.google.com/g-api/request",n.style.display="none",window.addEventListener("message",t),document.body.appendChild(n)})),$}function H(e){var t=JSON.parse(JSON.stringify(e));return E().then(function(e){return new Promise(function(n,r){var o=Date.now().toString()+c(8);window.addEventListener("message",function(e){e.data.requestId===o&&(e.data.error||!e.data.result?r(e.data.error):n(e.data.result))});var i=t.url.replace("https://www.googleapis.com","https://clients6.google.com").replace("https://www.google.com","https://clients6.google.com");pe.then(function(){t.key!==!1&&(i=j(i,"key",t.key||G)),e.contentWindow.postMessage({method:"apiRequest",ajax:{authuser:Q.authuser,pageid:Q.pageid,type:t.type,url:i,dataType:t.dataType,data:t.data,requestHeaders:t.requestHeaders,withCredentials:t.withCredentials},requestId:o},"https://"+(t.subDomain||"www")+".google.com/g-api/request")})})})}function L(){return te||(te=Promise.resolve().then(function(){var e=W&&Date.now()<B-500;return e?void 0:D()}).then(function(){te=!1})),te}function _(e){return p("https://accounts.google.com/o/oauth2/auth",{redirect_uri:"https://www.google.com/g-api/auth",response_type:"token",include_granted_scopes:!0,scope:e.scope,immediate:e.immediate,state:e.state,client_id:e.client_id,authuser:e.authuser,pageId:e.pageid})}function b(e){pe.then(function(){var n=[];if("string"==typeof e&&(n=Array.prototype.slice.call(arguments)),Array.isArray(e)&&(n=e),0!==n.length){n.push(U);var r=_({scope:n.join(" "),immediate:!1,state:"permissionRequest",client_id:K,authuser:Q.authuser,pageid:Q.pageid});t(r),window.close()}})}function R(e){return new Promise(function(t,n){var r=Array.isArray(e)?e:Array.prototype.slice.call(arguments);pe.then(L).then(function(){var o=se,i=r.every(function(e){return-1!==o.indexOf(e)});i?t(W):n({error:"notAuthorized",authorize:function(){b(e)}})})})}function I(e){var t=e.scope||[U];return R(t).then(function(t){return e.requestHeaders=e.requestHeaders||{},e.requestHeaders.Authorization||(e.requestHeaders.Authorization="Bearer "+t),u({type:e.type,url:e.url,dataType:e.dataType,data:e.data,requestHeaders:e.requestHeaders,withCredentials:e.withCredentials})})}function F(e){var t=e.url;return e.key!==!1&&(t=j(t,"key",e.key||G)),u({type:e.type,url:t,dataType:e.dataType,data:e.data,requestHeaders:e.requestHeaders,withCredentials:e.withCredentials})}function M(e){var t=JSON.parse(JSON.stringify(e));return E().then(function(e){return new Promise(function(n,r){var o=Date.now().toString()+c(8);window.addEventListener("message",function(e){e.data.requestId===o&&(e.data.error||!e.data.result?r(e.data.error):n(e.data.result))}),e.contentWindow.postMessage({method:"originRequest",ajax:{type:t.type,url:t.url,dataType:t.dataType,data:t.data,requestHeaders:t.requestHeaders,withCredentials:t.withCredentials},requestId:o},"https://"+(t.subDomain||"www")+".google.com/g-api/request")})})}function z(e){return e.originRequest===!0?M(e):e.notAuthenticated===!0?F(e):oe||re||e.internal!==!0?I(e):H(e)["catch"](function(){return I(e)})}function D(e){var t=e||0;return t>5?Promise.resolve({error:!0}):new Promise(function(e){function n(i){if("https://www.google.com"===i.origin&&i.data.timestamp===o.toString()&&"getToken"===i.data.method)if(window.removeEventListener("message",n),document.body.removeChild(r),i.data.error)"immediate_failed"===i.data.error?(se=[],e({error:"notAuthorized"})):e(D(t));else{var a=i.data.result.access_token;x(i.data.result).then(function(n){n.aud!==K?e(D(t)):(n.token=a,W=a,se=n.scope?n.scope.split(" "):[],B=1e3*n.exp,e(n))},function(){e(D(t))})}}t++;var r,o=Date.now();window.addEventListener("message",n),r=document.createElement("iframe"),r.style.display="none",r.src=_({immediate:!0,client_id:K,authuser:Q.authuser,pageid:Q.pageid,state:o,scope:U}),document.body.appendChild(r)})}function X(){return pe.then(function(){function e(){var e="n/bg/fetchcount",t=JSON.stringify([[],[null,null,null,null,"OGB"]]);return r(e,{"f.req":t}).then(function(e){return e[1]})}function t(){return u({url:n+"app/basic/home"}).then(function(e){var t=0;try{t=e.split('class="w4"')[1].split(">")[1].split("<")[0]}catch(n){return Promise.reject(n)}return t})}var n="https://plus.google.com/u/"+Q.authuser+"/";Q.pageid&&"none"!==Q.pageid&&(n+="b/"+Q.pageid+"/");var r=function(){function e(e,t,r){r.at=e;var o=[];for(var i in r)o.push(i+"="+encodeURIComponent(r[i]));return o=o.join("&"),u({type:"POST",url:n+"_/"+t+(-1!==t.indexOf("?")?"&":"?")+"rt=j",requestHeaders:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},data:o})}var t=cjExtensions.cache.get("gplusXrsfToken"),r=["f.ri","di","e"];return function(n,o){return t.then(function(r){return e(r,n,o)["catch"](function(r){var i=r.body;if(-1!==i.indexOf('"xsrf","')){var a=i.split('"xsrf","')[1].split('"')[0];return cjExtensions.cache.set("gplusXrsfToken",a),t=Promise.resolve(a),e(a,n,o)}return Promise.reject()})}).then(function(e){var t=e;t=l(t,"\n",""),t=l(t,",,",",null,"),t=l(t,"[,","[null,"),t=t.replace(")]}'",""),t=JSON.parse(t),t=t[0];for(var n=0;n<t.length;n++)if(r.indexOf(t[n][0]))return t[n]})}}();return e()["catch"](t).then(function(e){var t=e;return"string"==typeof t&&(t=parseInt(t,10)),isNaN(t)&&(t=0),t})})}var U,W,B,G,K,Q,V,Z,Y,$,ee,te,ne=window.chrome,re=-1!==navigator.userAgent.indexOf("OPR"),oe=-1!==navigator.userAgent.toLowerCase().indexOf("firefox"),ie="https://www.googleapis.com/auth/plus.me",ae="https://www.googleapis.com/auth/youtube.readonly",se=[],ue="en",ce={},de=!1,pe=new Promise(function(e){V=e}),le=new Promise(function(e){Z=e});window.g={getNotificationsCount:X,init:k,initialized:pe,request:z,modules:{load:C},auth:{requestPermission:b,getAccessToken:R},accounts:{list:q,add:S,signout:P,change:T},cache:{get:i,set:a,remove:s}}}();