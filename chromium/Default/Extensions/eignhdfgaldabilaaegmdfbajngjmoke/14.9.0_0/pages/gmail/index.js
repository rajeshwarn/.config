cjModules.define(function(){"use strict";return function(e,a){function n(a){if(a&&"notAuthorized"===a.error){e.textContent="";var n=bmElements.createElement("fulldialog",{serviceLogo:{labelPrefix:"",label:cjExtensions.i18n("cj_i18n_00416","Gmail")},iconName:"googlemail",message:cjExtensions.i18n("cj_i18n_00320","Before you can use this page, you need to give access to load your Gmail emails"),actionLabel:cjExtensions.i18n("cj_i18n_00224","Give permission"),action:a.authorize});e.appendChild(n)}}function i(e){var a=e.startsWith("tl")&&!e.startsWith("tl/search/"),n=a?"":"none";f.style.display=n,p.style.display=n}function t(e,a){return g.request({scope:I,url:cjBasics.urls.create(N+"users/me/"+e,a),dataType:"JSON"})["catch"](n)}function s(){return t("labels").then(function(e){var a=e.labels;return g.cache.set("gmailLabelsCache",a),a})}function o(){return g.cache.get("gmailLabelsCache").then(function(e){return Array.isArray(e)?e:Promise.reject("No cache available")})}function r(e){var a,n=[],i=!1;return e.forEach(function(e){if("UNREAD"!==e.id)if("system"===e.type){var t=0===e.id.indexOf("CATEGORY_");if(!t||"hide"!==e.messageListVisibility||"labelHide"!==e.labelListVisibility){t&&(i=!0);var s=L[e.id],o={id:e.id,newTabUrl:C+"#"+s.hash,label:s.label,iconName:s.iconName,sortIndex:s.sortIndex,iframeHash:s.iframeHash};"INBOX"===e.id?a=o:n.push(o)}}else n.push({id:e.id,newTabUrl:C+"#label/"+e.name,label:e.name,iconName:"__mdi:label",sortIndex:5e3,iframeHash:e.name.toLowerCase().replace(/ /g,"-")})}),i===!1&&n.push(a),n.push({id:"ALL",newTabUrl:C+"#"+L.ALL.hash,label:L.ALL.label,iconName:L.ALL.iconName,sortIndex:L.ALL.sortIndex,iframeHash:L.ALL.iframeHash}),n.sort(function(e,a){return e.sortIndex===a.sortIndex?e.label>a.label?1:-1:e.sortIndex>a.sortIndex?1:-1}),{labels:n,categories:i}}function l(e){return t("labels/"+e,{}).then(function(e){return e.threadsUnread})}function c(e){x.src=A.split("#")[0]+"#"+e,i(e)}function m(){var e=bmElements.createElement("pageheader",{color:"#ea4335",pageId:"gmail",searchboxProperties:{onSubmit:function(e){c("tl/search/"+e)}}});return e}function d(e){return bmElements.createElement("drawertabs",{onChange:function(e,a){c("tl/"+a.iframeHash)},items:e.labels,selected:e.categories?"CATEGORY_PERSONAL":"INBOX"})}function h(){var e=cjMaterial.createElement("drawer",{color:"#ea4335"});bmBasics.toggleLoading("on",e);var a=bmElements.createElement("servicelogo",{labelPrefix:"",label:cjExtensions.i18n("cj_i18n_00416","Gmail")});e.appendChild(a);var n=!1;return o().then(r).then(function(a){n||(E=a,b=d(a),e.appendChild(b))}),s().then(r).then(function(a){return n=!0,bmBasics.toggleLoading("off",e),b&&e.removeChild(b),E=a,b=d(a),e.appendChild(b),a.labels}).then(function(e){e.forEach(function(e){l(e.id).then(function(a){b.getEle(e.id).dataset.unreadcount=a})})}),e}function u(){var n=m();e.appendChild(n),j(n.searchbox.select);var t=cjMaterial.createElement("appbar",{secondary:!0,floating:!0});t.classList.add("mail-floating-toolbar"),e.appendChild(t),f=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){_.open()}}),t.appendChild(f),_=h(),e.appendChild(_),x=bmElements.createElement("iframe",{src:A}),x.addEventListener("wheel",function(e){x.sendMessage({method:"mailUpdateScroll",deltaY:e.deltaY})}),e.appendChild(x),p=cjMaterial.createElement("fab",{iconName:"__mdi:create",onClick:function(){c("co")}}),e.appendChild(p),window.addEventListener("message",function(e){var a=e.data.mailPageChange;a&&(a.startsWith("mn")?(_.open(),c("tl")):i(e.data.mailPageChange)),e.data.mailPageUrl&&(A=e.data.mailPageUrl)}),a.setOpenInNewHandler(function(){var e=!1,a=E&&E.labels,n=b&&b.selected;a&&n&&a.forEach(function(a){a.id===n&&(bmBasics.openTab(a.newTabUrl),e=!0)}),e||bmBasics.openTab(C)})}var _,b,f,p,x,E,j=a.onPageDisplay,I=["https://www.googleapis.com/auth/gmail.readonly"],N="https://www.googleapis.com/gmail/v1/",C="https://mail.google.com/mail/u/"+g.account.authuser+"/",A=cjBasics.urls.create("https://mail.google.com/mail/mu/mp/",{mui:"bm_mail",hl:"en",bm_id:g.account.authuser+"-"+g.account.userid,authuser:g.account.authuser},"#tl"),L={INBOX:{sortIndex:0,label:cjExtensions.i18n("cj_i18n_00299","Inbox"),hash:"inbox",iframeHash:"Inbox",iconName:"__mdi:inbox"},CATEGORY_PERSONAL:{sortIndex:1,label:cjExtensions.i18n("cj_i18n_00178","Primary"),hash:"inbox",iframeHash:"priority/^smartlabel_personal",iconName:"__mdi:inbox"},CATEGORY_SOCIAL:{sortIndex:2,label:cjExtensions.i18n("cj_i18n_00312","Social"),hash:"inbox",iframeHash:"priority/^smartlabel_social",iconName:"__mdi:people"},CATEGORY_PROMOTIONS:{sortIndex:3,label:cjExtensions.i18n("cj_i18n_00180","Promotions"),hash:"inbox",iframeHash:"priority/^smartlabel_promo",iconName:"__mdi:local_offer"},CATEGORY_UPDATES:{sortIndex:4,label:cjExtensions.i18n("cj_i18n_00313","Updates"),hash:"inbox",iframeHash:"priority/^smartlabel_notification",iconName:"__mdi:info"},CATEGORY_FORUMS:{sortIndex:5,label:cjExtensions.i18n("cj_i18n_00182","Forums"),hash:"inbox",iframeHash:"priority/^smartlabel_group",iconName:"__mdi:question_answer"},STARRED:{sortIndex:6,label:cjExtensions.i18n("cj_i18n_00004","Starred"),hash:"starred",iframeHash:"Starred",iconName:"__mdi:star"},IMPORTANT:{sortIndex:7,label:cjExtensions.i18n("cj_i18n_00184","Important"),hash:"imp",iframeHash:"Important",iconName:"__mdi:label_important"},CHAT:{sortIndex:8,label:cjExtensions.i18n("cj_i18n_00185","Chats"),hash:"chats",iframeHash:"Chats",iconName:"__mdi:hangout"},SENT:{sortIndex:9,label:cjExtensions.i18n("cj_i18n_00303","Sent"),hash:"sent",iframeHash:"Sent%20Mail",iconName:"__mdi:send"},DRAFT:{sortIndex:10,label:cjExtensions.i18n("cj_i18n_00187","Drafts"),hash:"drafts",iframeHash:"Drafts",iconName:"__mdi:drafts"},ALL:{sortIndex:11,label:cjExtensions.i18n("cj_i18n_00188","All Mail"),hash:"all",iframeHash:"All%20Mail",iconName:"__mdi:inbox"},SPAM:{sortIndex:12,label:cjExtensions.i18n("cj_i18n_00306","Spam"),hash:"spam",iframeHash:"Spam",iconName:"__mdi:report"},TRASH:{sortIndex:13,label:cjExtensions.i18n("cj_i18n_00005","Trash"),hash:"trash",iframeHash:"Trash",iconName:"__mdi:delete"}};u()}});