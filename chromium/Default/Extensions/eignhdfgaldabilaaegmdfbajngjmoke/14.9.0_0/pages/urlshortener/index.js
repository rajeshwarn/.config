cjModules.define(function(){"use strict";return function(e,t){function n(e){if(!e)return cjExtensions.i18n("cj_i18n_00338","Now");var t=e.split("T")[0].split("-"),n=[parseFloat(t[0]),parseFloat(t[1])-1,parseFloat(t[2])];return bmBasics.createDate(n)}function r(e){return e?e.allTime.shortUrlClicks:"0"}function a(e){var t=cjMaterial.createElement("card",{withPadding:!0});t.addEventListener("click",function(){bmBasics.openTab("https://goo.gl/#analytics/goo.gl/"+e.id.split("://goo.gl/")[1]+"/all_time")});var a=cjMaterial.createElement("title",{label:e.longUrl.split("?")[0]});a.classList.add("long-url-title"),t.appendChild(a);var i=cjMaterial.createElement("secondarytext",{label:cjExtensions.i18n("cj_i18n_00339","Short url")+": "}),l=document.createElement("a");l.addEventListener("click",function(e){e.stopPropagation(),bmBasics.openTab(l.href)}),l.textContent=e.id,l.href=e.id,i.appendChild(l),t.appendChild(i);var s=cjMaterial.createElement("secondarytext",{label:cjExtensions.i18n("cj_i18n_00340","Created")+": "+n(e.created)});t.appendChild(s);var o=cjMaterial.createElement("secondarytext",{label:cjExtensions.i18n("cj_i18n_00341","Click")+": "+r(e.analytics)});return t.appendChild(o),t}function i(){return g.request({scope:L,url:cjBasics.urls.create(y+"url/history",{projection:"ANALYTICS_CLICKS",fields:"items(analytics,created,id,longUrl)"}),dataType:"JSON"}).then(function(e){return v=!0,e.items},function(){return v=!1,Promise.reject()})}function l(t){var n=cjMaterial.createElement("card",{withPadding:!0});n.classList.add("results-card");var r=document.createElement("div"),a=cjExtensions.i18n("cj_i18n_00048","Press CTRL-C to copy");cjBasics.isMac&&(a=a.replace("CTRL","CMD")),r.dataset.tooltipText=a,r.className="tooltip tooltip--visible";var i=document.createElement("input");i.className="result",i.spellcheck=!1,i.readOnly=!0,i.value=t.shortUrl,i.addEventListener("blur",function(){r.classList.remove("tooltip--visible")}),i.addEventListener("click",function(){r.classList.add("tooltip--visible"),setTimeout(function(){i.select()},10)}),setTimeout(function(){i.select()},10),r.appendChild(i),n.appendChild(r);var l=cjMaterial.createElement("secondarytext",{label:cjExtensions.i18n("cj_i18n_00049","0 minutes ago")+" - "});l.classList.add("details-container");var s=document.createElement("a");s.className="details-link",s.href="https://goo.gl/#analytics/goo.gl/"+t.shortUrl.split("://goo.gl/")[1].split("/")[0]+"/all_time",l.appendChild(s),n.appendChild(l);var o=document.createElement("div"),c=document.createElement("a");c.className="originUrlButton",c.href=t.longUrl,c.textContent=t.longUrl,o.appendChild(c),n.appendChild(o),b.textContent="",b.appendChild(n),bmBasics.toggleLoading("off",e)}function s(t){b.textContent="";var n=cjMaterial.createElement("subheader",{label:"invalidUrl"===t.errorMessage?cjExtensions.i18n("cj_i18n_00050","Please fill in a valid URL"):cjExtensions.i18n("cj_i18n_00051","Error while generating short url")});b.appendChild(n),bmBasics.toggleLoading("off",e)}function o(t){bmBasics.toggleLoading("on",e),M(t).then(l,s)}function c(){v=!0,_.url&&o(_.url)}function d(){v=!1,_.url&&o(_.url);var e=cjMaterial.createElement("card",{withPadding:!0});e.textContent=cjExtensions.i18n("cj_i18n_00342","In order to view your recently shortened urls, you need to")+"\n",j=cjMaterial.createElement("button",{raised:!0,label:cjExtensions.i18n("cj_i18n_00160","Authorize"),onClick:function(){g.auth.requestPermission(L)}}),e.appendChild(j),C.appendChild(e),bmBasics.toggleLoading("off",C)}function u(){return i().then(function(e){e.forEach(function(e){var t=a(e);C.appendChild(t)}),bmBasics.toggleLoading("off",C)})}function p(){var e=cjMaterial.createElement("container",{scrollable:!0,shadow:!0,darker:!0});b=document.createElement("div"),b.className="create",e.appendChild(b),C=document.createElement("div"),C.className="list",bmBasics.toggleLoading("on",C);var t=cjMaterial.createElement("subheader",{label:cjExtensions.i18n("cj_i18n_00344","Previously shortened")});return C.appendChild(t),e.appendChild(C),e}function h(){x(function(){if(e.querySelector(".results-card")){var t=b.querySelector("input");t.focus(),t.select()}else E.select()})}function m(){_=cjBasics.urls.getParameters(),_.url?(E.value=_.url,h()):cjExtensions.getCurrentTab().then(function(e){var t=e.url;t&&(E.value=e.url),h()})}function f(){var t=bmElements.createElement("pageheader",{color:"#3367d6",pageId:"urlshortener",searchboxProperties:{iconName:"__mdi:link",onSubmit:o,label:cjExtensions.i18n("cj_i18n_00345","Enter a URL to shorten")}});E=t.searchbox,e.appendChild(t);var n=p();e.appendChild(n),m(),u().then(c,d)}var j,v,E,C,b,_,x=t.onPageDisplay,y="https://www.googleapis.com/urlshortener/v1/",L=["https://www.googleapis.com/auth/urlshortener"],M=function(){function e(e){return-1!==e.indexOf("http://")||-1!==e.indexOf("https://")}return function(t){return e(t)?g.request({notAuthenticated:!v,scope:L,type:"POST",dataType:"JSON",url:y+"url",data:JSON.stringify({longUrl:t}),requestHeaders:{"Content-Type":"application/json"}}).then(function(e){if(e.id){var n=a(e);return C.insertBefore(n,C.querySelector(".cj-md-card")),{status:"success",shortUrl:e.id,longUrl:t}}return{status:"error",errorMessage:e.error.message,response:e}},function(){return{status:"error",errorMessage:"error while receiving a short url",response:"error"}}):Promise.reject({status:"error",errorMessage:"invalidUrl"})}}();f()}});