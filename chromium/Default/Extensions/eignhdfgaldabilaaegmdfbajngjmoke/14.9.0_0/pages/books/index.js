cjModules.define(function(){"use strict";return function(e,t){function n(e){return parseInt(e.split("id-")[1],10)}function a(t){if(t&&"notAuthorized"===t.error){e.textContent="";var n=bmElements.createElement("fulldialog",{serviceLogo:{label:cjExtensions.i18n("cj_i18n_00285","Play Books")},iconName:"play_books",message:cjExtensions.i18n("cj_i18n_00321","Before you can use this page, you need to give access to load your Google Books. In case you only want to search for books, navigate to the search page in this extension."),actionLabel:cjExtensions.i18n("cj_i18n_00224","Give permission"),action:t.authorize});e.appendChild(n)}}function o(e){var t="undefined"!=typeof e.shelf;if(t&&e.noCache!==!0)return g.cache.get("bm__cache__books__shelf__"+e.shelf).then(function(t){return e.noCache=!0,t?{result:t,newRequest:!0,freshRequest:function(){return o(e)}}:o(e)});e.startIndex=e.startIndex||0;var n=T;"undefined"!=typeof e.shelf&&(n+="mylibrary/bookshelves/"+e.shelf+"/"),n+="volumes";var s=cjBasics.urls.create(n,{q:e.q,maxResults:e.maxResults,hl:g.lang,filter:t?null:e.searchFilter,startIndex:e.startIndex});return g.request({internal:!0,scope:R,dataType:"JSON",url:s}).then(function(n){var a=n.items,i=[];a&&a.forEach(function(e){var t=e.volumeInfo;i.push({id:e.id,title:t.title,previewLink:t.previewLink,authors:t.authors,openBook:-1!==s.indexOf("mylibrary/bookshelves")})});var r={result:i,newRequest:0===e.startIndex};return t&&0===e.startIndex&&g.cache.set("bm__cache__books__shelf__"+e.shelf,i),n.items=n.items||[],n.totalItems-e.startIndex-n.items.length!==0&&(r.followupRequest=function(){return e.startIndex+=e.maxResults,o(e)}),r},a)}function s(e){return o({maxResults:P,searchFilter:C.selected,shelf:e.shelf,q:e.q}).then(function(e){return _=e.followupRequest,e})}function i(e){var t=cjMaterial.createElement("griditem");t.addEventListener("click",function(){var t=(e.openBook&&e.previewLink?e.previewLink:"https://play.google.com/store/books/details/?id="+e.id)+"&authuser="+g.account.authuser;bmBasics.openTab(t)});var n=cjBasics.urls.create("https://books.google.com/books/reader",{printsec:"frontcover",img:"1",zoom:"1",id:e.id}),a=document.createElement("div");a.className="bookitem__thumbnail",a.style.backgroundImage='url("'+n+'")',t.appendChild(a);var o=document.createElement("div");o.className="cj-md-grid__item__bottom",t.appendChild(o);var s=document.createElement("div");s.className="cj-md-grid__item__textcontainer",o.appendChild(s);var i=document.createElement("div");i.textContent=e.title,s.appendChild(i);var r=20;if(Array.isArray(e.authors)){var l=document.createElement("div");l.className="cj-md-secondarytext",l.textContent=e.authors.join(" "),s.appendChild(l)}var c;return e.previewLink&&!e.openBook&&(r-=5,c=cjMaterial.createElement("iconbutton",{iconName:"__mdi:visibility",label:"Preview",onClick:function(){bmBasics.openTab(e.previewLink+"&authuser="+g.account.authuser)}}),o.appendChild(c)),cjColors.getDominantColor(n).then(function(e){o.style.backgroundColor=e.css,e.dark&&o.classList.add("cj-md--dark")}),e.title.length>r&&(i.title=e.title),t}function r(){var e=cjMaterial.createElement("emptystate",{color:S,label:cjExtensions("cj_i18n_00322","No books found"),iconName:"__mdi:book"});E.appendChild(e)}function l(t){var n=t.result;t.newRequest&&(E.textContent="",x=cjMaterial.createElement("gridcontainer"),E.appendChild(x),0===n.length&&r()),0!==n.length&&n.forEach(function(e){var t=i(e);x.appendChild(t)}),t.freshRequest?t.freshRequest().then(l):bmBasics.toggleLoading("off",e)}function c(){M.searchmenu.hide(),bmBasics.toggleLoading("on",e),E.textContent="",y.dataset.selected="search";var t=w.value;k=t,s({q:t}).then(l)}function u(e){var t=cjBasics.urls.create("https://play.google.com/store/search",{q:e,hl:g.lang,c:"books",authuser:g.account.authuser});bmBasics.openTab(t)}function d(){return g.request({internal:!0,scope:R,url:cjBasics.urls.create(T+"mylibrary/bookshelves",{fields:"items(id,title,volumeCount)",hl:g.lang}),requestHeaders:{"GData-Version":"3.0"},dataType:"JSON"}).then(function(e){if(e.items.length<=0)return Promise.reject({error:"noItems"});var t=e.items.map(function(e){return{id:"id-"+e.id,label:7===e.id?cjExtensions.i18n("cj_i18n_00323","My Books"):e.title,newTabUrl:cjBasics.urls.create("https://books.google.com/books",{as_coll:e.id,authuser:g.account.authuser,hl:g.lang})}});return t.sort(function(e){return"id-7"===e.id?-1:1}),t})}function h(e){return cjBasics.ajax({dataType:"JSON",url:cjBasics.urls.create("https://www.google.com/complete/search",{client:"serp",authuser:g.account.authuser,xhr:"t",hl:g.lang,q:e,ds:"bo"})})}function m(e){var t=Date.now();h(e).then(function(e){if(!(j>t)){j=t,L.textContent="";var n=e[1];if(n.length>0){for(var a=0;a<n.length;a++){var o,s=n[a],i=s[0],r=s[3];r&&r.b&&r.c?(i+="â€“ "+r.b,o=r.c):o=i.split("<b>").join("").split("</b>").join("");var l=cjMaterial.createElement("item");l.dataset.value=o,l.innerHTML=i,L.appendChild(l)}M.searchmenu.show()}else M.searchmenu.hide()}})}function p(){var t=cjMaterial.createElement("appbar",{color:S,secondary:!0});t.dataset.selected="mybooks";var a=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){B.open()}});a.dataset.view="mybooks",t.appendChild(a),I=cjMaterial.createElement("title",{label:cjExtensions.i18n("cj_i18n_00323","My Books")}),I.dataset.view="mybooks",t.appendChild(I);var o=cjMaterial.createElement("iconbutton",{iconName:"__mdi:arrow_back",onClick:function(){bmBasics.toggleLoading("on",e),t.dataset.selected="mybooks",w.clear(),s({shelf:n(q.selected)}).then(l)}});o.dataset.view="search",t.appendChild(o);var i=cjMaterial.createElement("title",{label:"Search"});return i.dataset.view="search",t.appendChild(i),C=cjMaterial.createElement("selectbox",{onChange:c,options:[{value:"ebooks",label:cjExtensions.i18n("cj_i18n_00198","All prices"),selected:!0},{value:"free-ebooks",label:cjExtensions.i18n("cj_i18n_00199","Free")},{value:"paid-ebooks",label:cjExtensions.i18n("cj_i18n_00200","Paid")}]}),C.dataset.view="search",t.appendChild(C),t}function b(){_&&_().then(l)}function f(){var o=cjMaterial.createElement("drawer",{color:S});bmBasics.toggleLoading("on",o);var i=bmElements.createElement("servicelogo",{labelPrefix:"google_logo Play ",label:cjExtensions.i18n("cj_i18n_00324","Books"),color:S});return o.appendChild(i),d().then(function(a){q=bmElements.createElement("drawertabs",{items:a,onChange:function(t,a){bmBasics.toggleLoading("on",e),E.textContent="",a&&(A=a.newTabUrl,I.textContent=a.label),s({shelf:n(t)}).then(l)},selected:"id-7"}),t.setOpenInNewHandler(function(){"search"===y.dataset.selected?u(k):bmBasics.openTab(A)}),o.appendChild(q),bmBasics.toggleLoading("off",o)},a),o}function v(){bmBasics.toggleLoading("on",e),M=bmElements.createElement("pageheader",{color:S,pageId:"books",includeSearchMenu:!0,searchboxProperties:{onClear:function(){M.searchmenu.hide()},onInput:m,onSubmit:c,onSubmitAlt:u}}),L=cjMaterial.createElement("list"),L.classList.add("bm-ele-autocomplete"),L.addEventListener("click",function(e){var t=e.target.dataset.value;M.searchbox.value=t,c(t)}),M.searchmenu.appendChild(L),w=M.searchbox,B=f(),e.appendChild(B),y=p(),E=cjMaterial.createElement("container",{scrollable:!0,shadow:!0,onScrollBottom:b}),e.appendChild(M),N(w.select),e.appendChild(y),e.appendChild(E),e.appendChild(B),s({shelf:7}).then(l)}var _,j,k,C,x,E,y,w,B,L,M,q,I,N=t.onPageDisplay,R=["https://www.googleapis.com/auth/books"],T="https://www.googleapis.com/books/v1/",P=12,S="#03a9f4",A="https://play.google.com/books?authuser="+g.account.authuser;v()}});