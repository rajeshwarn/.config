CNT={plugin:{},settings:{version:"4.1.0"},params:{}},CNT.createElement=function(e,t,a){var n=document.createElement(e);for(var i in t)if("textContent"===i)n.textContent=t[i];else if("appendChild"===i)n.appendChild(t[i]);else if("events"===i)for(var r in t[i])n.addEventListener(r,t[i][r]);else n.setAttribute(i,t[i]);return"undefined"!=typeof a&&a.appendChild(n),n},CNT.sortable={current:null,init:function(e,t,a){"undefined"==typeof a&&(a=!0);var n=document.createElement("div");n.addEventListener("dragenter",CNT.sortable.enter,!1),n.addEventListener("dragleave",CNT.sortable.leave,!1),n.addEventListener("drop",CNT.sortable.drop,!1);var i=document.createElement("div");i.addEventListener("dragenter",CNT.sortable.enter,!1),i.addEventListener("dragleave",CNT.sortable.leave,!1),i.addEventListener("drop",CNT.sortable.drop,!1),a===!0?(n.classList.add("sortable-top"),i.classList.add("sortable-bottom")):(n.classList.add("sortable-left"),i.classList.add("sortable-right")),e.draggable=!0,e.classList.add("sortable"),e.classList.add("sortable-order-"+t),e.updateKey=t,e.addEventListener("dragstart",CNT.sortable.start,!1),e.addEventListener("dragover",CNT.sortable.over,!1),e.appendChild(n),e.appendChild(i)},start:function(){document.body.classList.contains("body-sorting")===!1&&this.hasStart!==!0&&(this.parentNode.classList.add("sorting"),document.body.classList.add("body-sorting"),this.style.opacity="0.4",this.addEventListener("dragend",CNT.sortable.end,!1),current=this)},over:function(e){e.preventDefault()},enter:function(){if(current!==this.parentNode)for(var e=current.classList.length;e--;)"sortable"!==current.classList[e]&&this.parentNode.classList.contains(current.classList[e])&&this.classList.add("sortable-over")},leave:function(){this.classList.remove("sortable-over")},drop:function(e){e.stopPropagation&&e.stopPropagation(),current!=this&&this.classList.contains("sortable-over")===!0&&(this.classList.contains("sortable-left")||this.classList.contains("sortable-top")?this.parentNode.insertAdjacentElement("beforeBegin",current):(this.classList.contains("sortable-right")||this.classList.contains("sortable-bottom"))&&this.parentNode.insertAdjacentElement("afterEnd",current)),this.classList.remove("sortable-over"),cols=this.parentNode.parentNode.querySelectorAll(".sortable-order-"+current.updateKey),idArray=[];for(var t in cols)cols[t].id&&idArray.push(cols[t].id);return localStorage.setItem(current.updateKey,idArray.join(";")),!1},end:function(){-1!==Object.keys(CNT.plugin).indexOf(current.id)?ga("send","event","current.id","drag"):ga("send","event","apps-item","drag"),document.body.classList.remove("body-sorting"),this.parentNode.classList.remove("sorting"),current.style.opacity="",this.removeEventListener("dragend",CNT.sortable.end,!1)}},CNT.addPlugin=function(e){this.plugin[e.id]=e},CNT.askPermission=function(e,t){return new Promise(function(a,n){chrome.permissions.contains({permissions:t},function(i){if(i)a();else{CNT.card.clearContent(e);var r=document.createElement("x-button");r.innerText=chrome.i18n.getMessage("request_access"),r.addEventListener("click",function(){chrome.permissions.request({permissions:t},function(e){e?a():n()}.bind(this))}.bind(this)),CNT.card.appendContent(e,r)}}.bind(this))})},CNT.getClosestByClass=function(e,t){do if(e.classList&&e.classList.contains(t)===!0)return e;while(null!==(e=e.parentNode));return!1},CNT.icon=function(e,t,a){var n=document.createElementNS("http://www.w3.org/2000/svg","use");if(n.setAttributeNS("http://www.w3.org/1999/xlink","href","#svgicon-"+e),"string"==typeof a)n.classList.add(a);else if("undefined"!=typeof a)for(var i=0;i<a.length;i++)n.classList.add(a[i]);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");if("string"==typeof t)r.classList.add(t);else if("undefined"!=typeof t)for(var s=0;s<t.length;s++)r.classList.add(t[s]);return r.appendChild(n),r},CNT.iconUpdate=function(e,t,a){if(null!==e){var n=e.querySelector("use");if(n.setAttributeNS("http://www.w3.org/1999/xlink","href","#svgicon-"+t),"string"==typeof a)"-"===a[0]?e.classList.remove(a.substring(1)):e.classList.add(a);else if("undefined"!=typeof a)for(var i=0;i<a.length;i++)"-"===a[i][0]?e.classList.remove(a[i].substring(1)):e.classList.add(a[i])}},CNT.loadSvg=function(){CNT.promiseXHR("GET","image/icons.svg").then(function(e){var t=document.createElement("div");t.innerHTML=e.responseText,t.style.display="none",document.body.appendChild(t)})},CNT.notify=function(e,t){var a=document.createElement("div"),n=document.createElement("span");n.classList.add("cnt-paper-toast__action"),n.innerHTML=chrome.i18n.getMessage("label_close"),n.onclick=function(){a.classList.remove("cnt-paper-toast--opened"),CNT.promiseTimeout(100).then(function(){document.body.removeChild(a)}),"undefined"!=typeof t&&(localStorage.setItem("notifyCounter",t),"undefined"!=typeof CNT.notificationList[t+1]&&CNT.notify(CNT.notificationList[t+1],t+1))},a.classList.add("cnt-paper-toast"),a.innerHTML=e,a.appendChild(n),document.body.appendChild(a),CNT.promiseTimeout(100).then(function(){a.classList.add("cnt-paper-toast--opened")})},CNT.prepareInit=function(e){"false"===localStorage[e.id+"Enabled"]?e.enabled=!1:e.enabled=!0;for(var t in e.settings)if(null!==localStorage.getItem(t))e.settings[t].value=localStorage.getItem(t),"true"===e.settings[t].value?e.settings[t].value=!0:"false"===e.settings[t].value&&(e.settings[t].value=!1);else if(e.settings[t]["default"]instanceof Array)for(var a=0;a<e.settings[t]["default"].length;a++)-1!==e.settings[t].values.indexOf(e.settings[t]["default"][a])&&(e.settings[t].value=e.settings[t]["default"][a]);else e.settings[t].value=e.settings[t]["default"]},CNT.prettyDate=function(e){var t=new Date(e),a=((new Date).getTime()-t.getTime())/1e3,n=Math.floor(a/86400);return isNaN(n)?void 0:0===a&&0>a&&a>-60?chrome.i18n.getMessage("prettydate_justnow"):0===a&&0>a&&a>-120?"in one minute":0===a&&0>a&&a>-3600?"in "+Math.abs(Math.floor(a/60))+" minutes":0===a&&0>a&&a>-7200?"in one hour":0===a&&0>a&&a>-86400?"in "+Math.abs(Math.floor(a/3600))+" minutes":-1===n?"tomorrow":0>a&&n>-7?"in "+Math.abs(n)+" days":0>a&&n>-14?"in one week":0>a&&n>-31?"in "+Math.abs(Math.ceil(n/7))+" weeks":0>a&&n>-61?"in one month":0>a&&n>-365?"in "+Math.abs(Math.ceil(n/31))+" months":0>a&&n>-730?"in one year":0>a?"in a long time":0===n&&60>a?chrome.i18n.getMessage("prettydate_justnow"):0===n&&120>a?chrome.i18n.getMessage("prettydate_minuteago"):0===n&&3600>a?chrome.i18n.getMessage("prettydate_minutesago",[Math.floor(a/60)]):0===n&&7200>a?chrome.i18n.getMessage("prettydate_hourago"):0===n&&86400>a?chrome.i18n.getMessage("prettydate_hoursago",[Math.floor(a/3600)]):1===n?chrome.i18n.getMessage("prettydate_yesterday"):7>n?chrome.i18n.getMessage("prettydate_daysago",[n]):14>n?chrome.i18n.getMessage("prettydate_weekago"):31>n?chrome.i18n.getMessage("prettydate_weeksago",[Math.ceil(n/7)]):61>n?chrome.i18n.getMessage("prettydate_monthago"):365>n?chrome.i18n.getMessage("prettydate_monthsago",[Math.ceil(n/31)]):730>n?chrome.i18n.getMessage("prettydate_yearago"):chrome.i18n.getMessage("prettydate_longtimeago")},CNT.promiseXHR=function(e,t,a,n,i){return new Promise(function(r,s){var o=new XMLHttpRequest;if(o.forward=i,o.open(e,t,!0),a instanceof Array)for(var c=0;c<a.length;c++)"overrideMimeType"===a[c].key?o.overrideMimeType(a[c].value):o.setRequestHeader(a[c].key,a[c].value);o.onload=function(){r(this)},o.onerror=function(){s(this)},o.onabort=function(){s(this)},"undefined"!=typeof n?o.send(n):o.send()})},CNT.promiseTimeout=function(e){return new Promise(function(t){window.setTimeout(function(){t()},e)})},CNT.promiseAuth=function(e,t){return new Promise(function(a,n){chrome.identity.getAuthToken({interactive:e,scopes:t},function(e){chrome.runtime.lastError?n(!0):e?a(e):n(!0)})})},CNT.isChildOf=function(e,t){for(var a=t.parentNode;null!==a;){if(a==e)return!0;a=a.parentNode}return!1},CNT.getOffsetLeft=function(e){var t=0;do isNaN(e.offsetLeft)||(t+=e.offsetLeft);while(e=e.offsetParent);return t},CNT.ISODateString=function(e){function t(e){return 10>e?"0"+e:e}"undefined"==typeof e&&(e=new Date);var a=e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate()),n=t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds());return a+"T"+n+"Z"},CNT.cardOption={create:function(e,t,a){function n(){s.removeEventListener("transitionend",n),s.style.willChange="",l.style.willChange=""}function i(){s.parentNode.removeChild(s),l.parentNode.removeChild(l),s.removeEventListener("transitionend",i)}function r(e){e.target.closest("x-card")||(s.style.willChange="transform, left, right",l.style.willChange="opacity",s.addEventListener("transitionend",i),s.style.position="absolute",s.style.transform="scale(0, 0) translate(-50%, -50%)",s.style.top=s.initialTop-document.body.scrollTop+"px",s.style.left=s.initialLeft+"px",l.style.opacity="0")}var s=document.createElement("x-card");s.classList.add("card-option"),s.id=e,CNT.createElement("x-card-header",{textContent:t.title,icon:t.icon},s);var o=CNT.createElement("x-card-content",{},s);if(a!==!0){var c=document.getElementById(e).querySelector("x-card-header").getBoundingClientRect();s.initialTop=c.top,s.initialLeft=c.left,s.style.position="absolute",s.style.top=c.top-document.body.scrollTop+"px",s.style.left=c.left+"px",s.style.willChange="transform, left, right",s.addEventListener("transitionend",n);var l=document.createElement("div");l.classList.add("card-option__overlay"),l.style.willChange="opacity",l.addEventListener("click",r),document.body.appendChild(l),CNT.promiseTimeout(16).then(function(){l.style.opacity=1,s.style.left="50%",s.style.top="50%",s.style.transform="scale(1, 1) translate(-50%, -50%)"})}"general"!==e&&"support"!==e&&o.appendChild(CNT.cardOption.buildYesNo(e+"Enabled",{description:chrome.i18n.getMessage(e+"Enabled"),value:CNT.plugin[e].enabled},e));for(var d in t.settings){var u=t.settings[d];u.custom?o.appendChild(CNT.cardOption.buildCustom(d,u,e)):u.values?o.appendChild(CNT.cardOption.buildSelect(d,u,e)):"number"==typeof u["default"]?o.appendChild(CNT.cardOption.buildNumber(d,u,e)):u["default"]!==!0&&u["default"]!==!1||o.appendChild(CNT.cardOption.buildYesNo(d,u,e))}t.reset&&o.appendChild(CNT.cardOption.buildReset(t.reset,{description:chrome.i18n.getMessage(t.reset+"Reset")},e)),a===!0?document.querySelector(".card-container").appendChild(s):document.querySelector(".card-option__overlay").appendChild(s)},buildCustom:function(e,t,a){var n=document.createElement("div");n.classList.add("item__legend"),n.innerText=t.description;var i=document.createElement("div");i.classList.add("item__value");var r=document.createElement("div");r.classList.add("item"),r.classList.add("item__type-custom"),r.appendChild(n),r.appendChild(i),r.data={name:e,id:a};var s=document.querySelector(".dialog__content"),o=document.querySelector(".dialog__button-ok");return o.setAttribute("data-id",a),t.clickable===!0&&r.addEventListener("click",function(){document.querySelector("dialog").showModal(this.data),s.innerText="",t.custom(s,i)}),t.custom(s,i),r},buildReset:function(e,t,a){var n=document.createElement("div");n.classList.add("item__legend"),n.innerText=t.description;var i=document.createElement("div");return i.classList.add("item"),i.classList.add("item__type-reset"),i.appendChild(n),i.data={name:e,id:a},i.addEventListener("click",function(){confirm(chrome.i18n.getMessage("confirmReset"))&&(localStorage.removeItem(this.data.name),CNT.card&&CNT.card.refresh(this.data.id))}),i},buildSelect:function(e,t,a){var n=document.createElement("div");n.classList.add("item__legend"),n.innerText=t.description;var i=document.createElement("select");i.classList.add("item__form"),i.data={name:e,id:a},i.addEventListener("change",function(){localStorage.setItem(this.data.name,this.value),CNT.card&&CNT.card.refresh(this.data.id)});var r=document.createElement("option");r.setAttribute("value",""),r.innerText=chrome.i18n.getMessage("automatic"),t.value||r.setAttribute("selected",!0),i.appendChild(r);for(var s=0;s<t.values.length;s++){var o="",c="";t.valuesPrefix?(o=t.valuesPrefix+"_"+t.values[s].replace("-","_").toLowerCase(),c=chrome.i18n.getMessage(o)):"number"==typeof t.values[s]?c=t.values[s]:(o=t.values[s],c=chrome.i18n.getMessage(o)),r=document.createElement("option"),r.setAttribute("value",t.values[s]),r.innerText=c,t.value&&t.value.toString()===t.values[s].toString()&&r.setAttribute("selected",!0),i.appendChild(r)}var l=document.createElement("div");return l.classList.add("item"),l.classList.add("item__type-select"),l.appendChild(n),l.appendChild(i),l},buildYesNo:function(e,t,a){"string"==typeof t.value&&(t.value=t.value===!0);var n=document.createElement("div");n.classList.add("item__legend"),n.innerText=t.description;var i=document.createElement("input");i.classList.add("item__form"),i.classList.add("item__form-checkbox"),i.type="checkbox",i.checked=t.value,i.data={name:e,id:a},i.addEventListener("change",function(){localStorage.setItem(this.data.name,this.checked),CNT.card&&CNT.card.refresh(this.data.id)});var r=document.createElement("div");return r.classList.add("item"),r.classList.add("item__type-yesno"),r.appendChild(n),r.appendChild(i),r}},CNT.page="options",CNT.init=function(){var e=document.querySelector(".dialog__button-ok");e.innerText=chrome.i18n.getMessage("actionOk"),e.addEventListener("click",function(){document.querySelector(".dialog").close(),"undefined"!=typeof CNT.card&&CNT.card.refresh(this.getAttribute("data-id"))});var t=document.querySelector(".dialog");t.addEventListener("click",function(e){var a=t.getBoundingClientRect(),n=a.top<=e.clientY&&e.clientY<=a.top+a.height&&a.left<=e.clientX&&e.clientX<=a.left+a.width;!n&&t.open&&t.close()}),CNT.loadSvg(),this.prepareInit(this.general),this.cardOption.create("general",this.general,!0);for(var a in this.plugin)this.prepareInit(this.plugin[a]),this.cardOption.create(a,this.plugin[a],!0)},CNT.addPlugin({id:"apps",icon:"apps",resizable:!0,reset:["appsOrder"],params:{},settings:{},title:chrome.i18n.getMessage("apps"),titleUrl:"chrome://apps/",content:function(e){e.unshift({id:"store",isApp:!0,name:"Chrome Web Store",icons:{128:{size:128,url:"image/store.png"}}});var t={},a=(localStorage.getItem("appsOrder")||"").split(";");for(var n in e)t[e[n].id]=e[n],-1===a.indexOf(e[n].id)&&a.push(e[n].id);var i=0;for(var r in a)i++,""!==a[r]&&t[a[r]]&&t[a[r]].isApp===!0&&CNT.card.appendContent("apps",this.drawApp(t[a[r]]));for(;i%5!==4;){i++;var s=document.createElement("div");s.classList.add("apps-item"),s.classList.add("apps-item--faker"),CNT.card.appendContent("apps",s)}},drawApp:function(e){var t=document.createElement("img");t.classList.add("apps-item-image"),t.height="50",t.width="50";var a=document.createElement("a");for(var n in e.icons)128===e.icons[n].size&&(t.src=e.icons[n].url);a.classList.add("apps-item"),a.id=e.id,"store"===e.id?a.addEventListener("click",function(){ga("send","event","apps","launchStore"),window.location.href="https://chrome.google.com/webstore/category/apps"}):a.addEventListener("click",function(){ga("send","event","apps","launchApp"),chrome.management.launchApp(this.id,function(){CNT.general.settings.generalNewTab.value===!1&&window.close()})}),CNT.sortable.init(a,"appsOrder",!1);var i=" "+e.name;return""===t.src&&(t.src="chrome://extension-icon/"+e.id+"/16/1",t.classList.add("apps-image-favicon"),i=""+e.name.replace("http://","").replace("https://","").replace(/\/$/,"")),a.addEventListener("mouseover",function(){var e=document.createElement("tooltip");e.classList.add("tooltip"),e.innerText=i,document.body.appendChild(e);for(var t=this,n=0,r=0;t.offsetParent;)n+=t.offsetTop,r+=t.offsetLeft,t=t.offsetParent;n+=a.offsetHeight,r+=a.offsetWidth/2,e.style.top=n+"px",e.style.left=r+"px",e.style.transform="scale(1) translate(-50%, 0)",this.addEventListener("mouseout",function(){e.style.transform="scale(0) translate(-50%, 0)",CNT.promiseTimeout(1e3).then(function(){e.parentNode&&e.parentNode.removeChild(e)})})}),a.appendChild(t),a},draw:function(){CNT.card.clearContent("apps"),chrome.management.getAll(this.content.bind(this))},init:function(){CNT.askPermission("apps",["management"]).then(this.draw.bind(this),function(){CNT.card.addError("apps",chrome.i18n.getMessage("error_occurs"))})}}),CNT.addPlugin({id:"bookmark",icon:"bookmark-outline",resizable:!0,params:{},settings:{bookmarkInitial:{"default":"all",description:chrome.i18n.getMessage("bookmarkInitial"),values:["all","recent"],valuesPrefix:"label"}},title:chrome.i18n.getMessage("bookmark"),content:function(e){1===e.length?(e[0].parentId&&"0"!==e[0].parentId?(this.params.parentId=e[0].parentId,document.querySelector("x-tab.tabs__item-parent").style.display=""):(delete this.params.parentId,document.querySelector("x-tab.tabs__item-parent").style.display="none"),e=e[0].children):document.querySelector("x-tab.tabs__item-parent").style.display="none";for(var t=0;t<e.length;t++)CNT.card.appendContent("bookmark",this.drawItem(e[t]));0===e.length&&CNT.card.notice("bookmark",chrome.i18n.getMessage("nocontent")),CNT.plugin.bookmark.params.currentTab&&CNT.plugin.bookmark.params.currentTab.setActive()},drawItem:function(e){var t=document.createElement("x-card-item");return t.innerText=e.title,t.setAttribute("image","small"),e.url?(t.setAttribute("href",e.url),t.setAttribute("src","chrome://favicon/"+e.url),t.addEventListener("click",function(){ga("send","event","bookmarks","launchBookmark")}.bind(this))):(t.appendChild(CNT.icon("folder",["cnt-card-item__image-small","cnt-card-item__image"])),t.addEventListener("click",function(){this.drawLevel(e.id),ga("send","event","bookmarks","subFolder")}.bind(this))),t},drawTabs:function(){return CNT.card.setTabs("bookmark",[{content:CNT.icon("keyboard-backspace","tabs__item-icon"),click:function(){CNT.plugin.bookmark.params.currentTab=this.parentNode.querySelector(".tabs__item-all"),CNT.plugin.bookmark.drawLevel(CNT.plugin.bookmark.params.parentId)},className:"tabs__item-parent",style:"width: 38px;"+(this.params.parentId?"":"display: none;"),active:!1},{content:chrome.i18n.getMessage("label_recent"),click:function(){this.setActive(),CNT.plugin.bookmark.params.currentTab=this,CNT.plugin.bookmark.drawRecent()},className:"tabs__item-recent",active:"recent"===this.settings.bookmarkInitial.value},{content:chrome.i18n.getMessage("label_all"),click:function(){this.setActive(),CNT.plugin.bookmark.params.currentTab=this,CNT.plugin.bookmark.drawLevel("1")},className:"tabs__item-all",active:"recent"!==this.settings.bookmarkInitial.value}])},drawLevel:function(e){CNT.card.clearContent("bookmark"),chrome.bookmarks.getSubTree(e,this.content.bind(this))},drawRecent:function(){CNT.card.clearContent("bookmark"),chrome.bookmarks.getRecent(parseInt(CNT.general.settings.generalListSize.value,10),this.content.bind(this))},draw:function(){"recent"===this.settings.bookmarkInitial.value?this.drawRecent():this.drawLevel("1")},init:function(){CNT.askPermission("bookmark",["bookmarks"]).then(this.drawTabs.bind(this)).then(this.draw.bind(this),function(){CNT.card.addError("bookmark",chrome.i18n.getMessage("error_occurs"))})}}),CNT.addPlugin({id:"calendar",icon:"calendar",resizable:!0,settings:{calendarList:{description:chrome.i18n.getMessage("calendarList"),clickable:!0,custom:function(e){return CNT.promiseAuth(!1,CNT.plugin.calendar.scopes).then(function(t){return CNT.promiseXHR("GET","https://www.googleapis.com/calendar/v3/users/me/calendarList/",[{key:"Authorization",value:"Bearer "+t}]).then(function(e){var t=JSON.parse(e.responseText);return Promise.resolve(t.items)}).then(function(t){t.forEach(function(t){var a=JSON.parse(localStorage.getItem("calendarList")||"{}"),n=document.createElement("div");n.classList.add("item__legend"),n.innerText=t.summary;var i=document.createElement("input");i.classList.add("item__form"),i.classList.add("item__form-checkbox"),i.type="checkbox",i.checked="undefined"!=typeof a[t.id],i.data={backgroundColor:t.backgroundColor,foregroundColor:t.foregroundColor,name:t.summary,id:t.id},i.addEventListener("change",function(){var e=JSON.parse(localStorage.getItem("calendarList")||"{}");this.checked?e[this.data.id]=this.data:delete e[this.data.id],localStorage.setItem("calendarList",JSON.stringify(e)),CNT.card&&CNT.card.refresh("calendar")});var r=document.createElement("div");r.classList.add("item"),r.classList.add("item__type-yesno"),r.appendChild(n),r.appendChild(i),e.appendChild(r)})})})}}},scopes:["https://www.googleapis.com/auth/calendar.readonly","https://www.googleapis.com/auth/calendar"],title:chrome.i18n.getMessage("calendar"),titleUrl:"https://calendar.google.com/calendar/",_prepareData:function(e){return[].concat.apply([],e.map(function(e){var t=JSON.parse(e.responseText);return t.items.map(function(e){return e.backgroundColor=this.forward.backgroundColor,e.foregroundColor=this.forward.foregroundColor,e},e)})).map(function(e){var t=new Date(e.end.dateTime||e.end.date),a=new Date(e.start.dateTime||e.start.date);return{startDate:a,endDate:t,backgroundColor:e.backgroundColor,foregroundColor:e.foregroundColor,organizer:e.organizer?e.organizer.displayName||e.organizer.email:"",title:e.summary?e.summary:e.status,link:e.htmlLink,duration:t-a>864e5?Math.floor((t-a)/864e5):0}}).sort(function(e,t){return e.startDate>t.startDate?1:-1})},_drawItem:function(e){var t=document.createElement("div");t.classList.add("cnt-card-item__image-medium"),t.classList.add("cnt-card-item__image"),t.style.backgroundColor=e.backgroundColor,t.style.color=e.foregroundColor,t.innerText=e.startDate.getDate();var a=CNT.prettyDate(e.startDate);e.organizer&&(a+=" - "+e.organizer),e.duration&&(a+=" - "+e.duration+" "+chrome.i18n.getMessage("days"));var n=e.startDate.toLocaleTimeString(["en-US"],{hour:"2-digit",minute:"2-digit"}),i=document.createElement("x-card-item");return i.appendChild(document.createTextNode(e.title)),i.appendChild(t),i.setAttribute("tag",n),i.setAttribute("image","medium"),i.setAttribute("line",2),i.setAttribute("detail",a),i.setAttribute("href",e.link),i.addEventListener("click",function(){ga("send","event","calendar","launchCalendar")}),CNT.card.appendContent("calendar",i)},_prepareDrawItems:function(){var e="";return function(t){if(t.startDate=new Date(t.startDate),t.endDate=new Date(t.endDate),e!==""+t.startDate.getFullYear()+(t.startDate.getMonth()+1)){var a=document.createElement("x-card-section");a.innerText=t.startDate.toLocaleDateString(CNT.plugin.datetime.settings.datetimeLanguage.value,{month:"long"}),CNT.card.appendContent("calendar",a),e=""+t.startDate.getFullYear()+(t.startDate.getMonth()+1)}return this._drawItem(t)}}(),_drawItems:function(){var e=JSON.parse(localStorage.getItem("calendarData"));return e=e.slice(0,CNT.general.settings.generalListSize.value),0===e.length?(CNT.card.notice("calendar",chrome.i18n.getMessage("nocontent")),Promise.resolve()):e.map(this._prepareDrawItems,this)},_getData:function(e){var t=JSON.parse(localStorage.getItem("calendarList")||"{}"),a=Object.keys(t).map(function(e){return t[e]}).map(function(t){var a="https://www.googleapis.com/calendar/v3/calendars/"+encodeURIComponent(t.id)+"/events?orderBy=startTime&maxResults=10&singleEvents=true&timeMin="+CNT.ISODateString();return CNT.promiseXHR("GET",a,[{key:"Authorization",value:"Bearer "+e}],void 0,t)});return Promise.all(a)},draw:function(){var e=Promise.resolve();(new Date).getTime()-localStorage.getItem("calendarTime")>3e5&&(e=e.then(CNT.promiseAuth.bind(CNT,!1,this.scopes)).then(this._getData.bind(this)).then(this._prepareData.bind(this)).then(function(e){return localStorage.setItem("calendarData",JSON.stringify(e)),localStorage.setItem("calendarTime",(new Date).getTime()),Promise.resolve()})),e=e.then(CNT.card.clearContent.bind(CNT.card,"calendar")).then(this._drawItems.bind(this))["catch"](this.getConnectButton.bind(this))},init:function(){this.draw()},getConnectButton:function(){CNT.card.clearContent("calendar");var e=document.createElement("x-button");e.innerText=chrome.i18n.getMessage("request_access"),e.addEventListener("click",function(){CNT.promiseAuth(!0,this.scopes).then(this.draw.bind(this))}.bind(this)),CNT.card.appendContent("calendar",e)}}),CNT.addPlugin({id:"datetime",icon:"clock",resizable:!1,params:{oldHour:0,oldMinute:0},settings:{datetimeLanguage:{"default":navigator.language,description:chrome.i18n.getMessage("datetimeLanguage"),values:["am","bg","bn","ca","cs","ar","da","de","el","en","es","et","fa","fi","fil","fr","gu","he","hi","hr","hu","id","it","ja","kn","ko","lt","lv","ml","mr","ms","nl","no","pl","pt","ro","ru","sk","sl","sr","sv","sw","ta","te","th","tr","uk","vi","zh"],valuesPrefix:"lang"},datetimeFormat:{"default":"12",description:chrome.i18n.getMessage("datetimeFormat"),values:["12","24"],valuesPrefix:"time"},datetimePrependZeroHour:{"default":!1,description:chrome.i18n.getMessage("datetimePrependZeroHour")},datetimePrependZeroMinute:{"default":!0,description:chrome.i18n.getMessage("datetimePrependZeroMinute")}},title:chrome.i18n.getMessage("datetime"),content:function(){this.params.htmlHours=document.createElement("span"),this.params.htmlHours.classList.add("datetime-hours"),CNT.card.appendContent("datetime",this.params.htmlHours),this.params.htmlMinutes=document.createElement("span"),this.params.htmlMinutes.classList.add("datetime-minutes"),CNT.card.appendContent("datetime",this.params.htmlMinutes),this.params.htmlAmpm=document.createElement("span"),this.params.htmlAmpm.classList.add("datetime-ampm"),CNT.card.appendContent("datetime",this.params.htmlAmpm)},draw:function(){this.currentDatetime=new Date,this.currentHour=this.currentDatetime.getHours(),this.currentMinute=this.currentDatetime.getMinutes(),this.currentHour===this.params.oldHour&&this.currentMinute===this.params.oldMinute&&this.forceDraw!==!0||(this.forceDraw=!1,this.params.oldHour=this.currentHour,this.params.oldMinute=this.currentMinute,"24"!==this.settings.datetimeFormat.value?(this.ampm="am",this.currentHour>=12&&(this.ampm="pm"),this.currentHour>12?this.currentHour-=12:0===this.currentHour&&(this.currentHour=12),this.params.htmlAmpm.innerText=this.ampm):this.params.htmlAmpm.innerText="",this.settings.datetimePrependZeroHour.value===!0&&this.currentHour<10&&(this.currentHour="0"+this.currentHour),this.settings.datetimePrependZeroMinute.value===!0&&this.currentMinute<10&&(this.currentMinute="0"+this.currentMinute),this.params.htmlHours.innerText=this.currentHour,this.params.htmlMinutes.innerText=this.currentMinute,this.settings.datetimeLanguage.value=this.settings.datetimeLanguage.value||navigator.language,CNT.card.setTitle("datetime",this.currentDatetime.toLocaleDateString(this.settings.datetimeLanguage.value,{weekday:"long",year:"numeric",month:"long",day:"numeric"})))},init:function(){if(null===localStorage.getItem("datetimeFormat")){var e=(new Date).toLocaleTimeString();"AM"===e.slice(-2)||"PM"===e.slice(-2)?this.settings.datetimeFormat.value="12":this.settings.datetimeFormat.value="24"}this.settings.datetimeLanguage.value=this.settings.datetimeLanguage.value||navigator.language,CNT.card.clearContent("datetime"),this.content(),this.draw(),window.setInterval(this.draw.bind(this),1e3)}}),CNT.addPlugin({id:"download",icon:"download",resizable:!0,params:{},settings:{},title:chrome.i18n.getMessage("download"),titleUrl:"chrome://downloads/",_drawItem:function(e){var t=e.filename.split(/\\|\//),a=document.createElement("x-card-item-icon");a.setAttribute("icon","delete"),a.id=e.id,a.addEventListener("click",this._closeListener);var n=document.createElement("x-card-item");return n.innerText=t[t.length-1],n.appendChild(a),n.setAttribute("detail",e.url),n.setAttribute("image","small"),n.addEventListener("click",function(){ga("send","event","download","launchDownload"),chrome.downloads.show(e.id)}),chrome.downloads.getFileIcon(e.id,{size:16},function(e){n.setAttribute("src",e)}),CNT.card.appendContent("download",n)},_closeListener:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=this.closest("x-card-item");t.parentNode.removeChild(t),chrome.downloads.erase({id:parseInt(this.id)},function(){ga("send","event","download","trash"),this.draw()}.bind(CNT.plugin.download))},_getData:function(){return new Promise(function(e){chrome.downloads.search({orderBy:["-startTime"],state:"complete",exists:!0,limit:parseInt(CNT.general.settings.generalListSize.value)},e)})},content:function(e){return 0===e.length?(CNT.card.notice("download",chrome.i18n.getMessage("nocontent")),Promise.resolve()):Promise.all(e.map(function(e){return this._drawItem(e)},this))},draw:function(){return CNT.card.clearContent("download").then(this._getData).then(this.content.bind(this))},init:function(){CNT.askPermission("download",["downloads"]).then(this.draw.bind(this),function(){CNT.card.addError("download",chrome.i18n.getMessage("error_occurs"))})}}),CNT.addPlugin({id:"drive",icon:"drive",resizable:!0,settings:{},scopes:["https://www.googleapis.com/auth/drive"],title:chrome.i18n.getMessage("drive"),titleUrl:"http://drive.google.com/",_launchCallback:function(){ga("send","event","drive","launchDrive")},_drawItem:function(e){var t=document.createElement("img");t.classList.add("cnt-card-item__image-icon"),t.src=e.icon;var a;e.favicon?(a=document.createElement("img"),a.src=e.favicon):(a=document.createElement("div"),a.classList.add("cnt-card-item__image-placeholder")),a.classList.add("cnt-card-item__image-medium"),a.classList.add("cnt-card-item__image"),a.appendChild(t);var n=document.createElement("x-card-item");return n.innerText=e.title,n.appendChild(a),n.setAttribute("image","medium"),n.setAttribute("detail",e.user+" - "+e.date),n.setAttribute("href",e.href),n.addEventListener("click",this._launchCallback),CNT.card.appendContent("drive",n)},_drawItems:function(){var e=JSON.parse(localStorage.getItem("driveData"));return 0===e.length?(CNT.card.notice("drive",chrome.i18n.getMessage("nocontent")),Promise.resolve()):(e=e.slice(0,CNT.general.settings.generalListSize.value),e.map(function(e){return this._drawItem(e)},this))},_getData:function(e){var t="https://www.googleapis.com/drive/v2/files?maxResults=15";return CNT.promiseXHR("GET",t,[{key:"Authorization",value:"Bearer "+e}])},_parseData:function(e){var t=JSON.parse(e.responseText);return t=t.items.map(function(e){var t={icon:e.iconLink,title:e.title,user:e.lastModifyingUserName,date:CNT.prettyDate(e.modifiedDate.toString()),href:e.alternateLink};return e.lastModifyingUser.picture&&(t.favicon=e.lastModifyingUser.picture.url),t}),localStorage.setItem("driveData",JSON.stringify(t)),localStorage.setItem("driveTime",(new Date).getTime()),Promise.resolve()},draw:function(){navigator.onLine===!1?CNT.card.clearContent("drive").then(this._drawItems.bind(this)):CNT.promiseAuth(!1,this.scopes).then(function(e){return(new Date).getTime()-localStorage.getItem("driveTime")>3e5?this._getData(e).then(this._parseData.bind(this)):Promise.resolve()}.bind(this)).then(CNT.card.clearContent.bind(CNT.card,"drive")).then(this._drawItems.bind(this))["catch"](this.getConnectButton.bind(this))},init:function(){this.draw()},getConnectButton:function(){CNT.card.clearContent("drive");var e=document.createElement("x-button");e.innerText=chrome.i18n.getMessage("request_access"),e.addEventListener("click",function(){CNT.promiseAuth(!0,this.scopes).then(this.draw.bind(this))}.bind(this)),CNT.card.appendContent("drive",e)}}),CNT.general={id:"general",generalStartMorning:6,generalStartDay:9,generalStartEvening:18,generalStartNight:21,icon:"settings",reset:["blocksOrder"],settings:{generalHeaderType:{"default":"normal",description:chrome.i18n.getMessage("generalHeaderType"),values:["normal","small","disabled"]},generalNewTab:{"default":!1,description:chrome.i18n.getMessage("generalNewTab")},generalSuggest:{"default":!0,description:chrome.i18n.getMessage("generalSuggest")},generalAnalytics:{"default":!0,description:chrome.i18n.getMessage("generalAnalytics")},generalListSize:{"default":6,description:chrome.i18n.getMessage("generalListSize"),values:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]
},generalTheme:{"default":"light",description:chrome.i18n.getMessage("generalTheme"),values:["light","dark"]},generalBackground:{description:chrome.i18n.getMessage("generalBackground"),clickable:!0,custom:function(e,t){var a=function(){localStorage.hasOwnProperty("generalBackground")===!1&&(r.style.display="none",t.style.backgroundImage="",i.value="")},n=function(){localStorage.getItem("generalBackground")&&(t.style.backgroundImage="url("+localStorage.getItem("generalBackground")+")",r.style.display="")},i=document.createElement("input"),r=CNT.icon("delete","option-general-background");t.classList.add("option-general-background-value"),r.addEventListener("click",function(){localStorage.removeItem("generalBackground"),a()}),a(),n(),i.classList.add("option-general-background-field"),i.type="file",i.onchange=function(){var e=new FileReader;e.onload=function(e){localStorage.setItem("generalBackground",e.target.result),n()},e.readAsDataURL(i.files[0])},e.appendChild(i),e.appendChild(r)}},generalShowSettingsStartup:{"default":!0,description:chrome.i18n.getMessage("generalShowSettingsStartup")}},title:chrome.i18n.getMessage("general"),init:function(){this.click(),this.image(),this.placeholder(),this.size(),this.suggest(),this.okGoogle(),localStorage.getItem("generalBackground")&&(CNT.params.html.style.backgroundImage="url("+localStorage.getItem("generalBackground")+")",CNT.params.html.style.backgroundPosition="center center",CNT.params.html.style.backgroundSize="cover")},click:function(){document.removeEventListener("click",this.linkClickListener),document.addEventListener("click",this.linkClickListener)},image:function(){var e="",t=(new Date).getHours();e=t>=this.generalStartMorning&&t<this.generalStartDay?"header-morning":t>=this.generalStartDay&&t<this.generalStartEvening?"header-day":t>=this.generalStartEvening&&t<this.generalStartNight?"header-evening":"header-night",CNT.params.html.classList.contains(e)===!1&&(CNT.params.html.classList.remove("header-morning"),CNT.params.html.classList.remove("header-day"),CNT.params.html.classList.remove("header-evening"),CNT.params.html.classList.remove("header-night"),CNT.params.html.classList.add(e))},linkClickListener:function(e){if(null===e.target.closest(".bookmarks")){for(var t=document.querySelectorAll(".bookmarks-folder-children"),a=0;a<t.length;a++)t[a].innerText="";var n=document.querySelector(".bookmarks-folder-children-more");null!==n&&(n.style.display="none")}var i=e.target.closest("a");i&&(CNT.general.settings.generalNewTab.value===!0?i.target="_blank":i.target="_self")},placeholder:function(){CNT.params.search&&CNT.params.search.hasAttribute("placeholder")===!1&&CNT.params.search.setAttribute("placeholder",chrome.i18n.getMessage("search"))},searchBlurListener:function(){CNT.promiseTimeout(100).then(function(){CNT.params.suggest&&(CNT.params.suggest.style.display="none")})},searchClickListener:function(e){"LI"===e.target.tagName&&(window.location.href="https://www.google.com/#q="+e.target.innerText,ga("send","event","general","search"))},searchKeyupListener:function(e){if(CNT.general.settings.generalSuggest.value===!0||13===e.keyCode){var t=CNT.params.suggest.querySelector(".active"),a=CNT.params.suggest.querySelectorAll("li");if(37===e.keyCode||38===e.keyCode)null===t?a[a.length-1].classList.add("active"):t===a[0]?(t.classList.remove("active"),a[a.length-1].classList.add("active")):(t.classList.remove("active"),t.previousElementSibling.classList.add("active"));else if(39===e.keyCode||40===e.keyCode)null===t?a[0].classList.add("active"):t===a[a.length-1]?(t.classList.remove("active"),a[0].classList.add("active")):(t.classList.remove("active"),t.nextElementSibling.classList.add("active"));else if(13===e.keyCode)null!==t&&(CNT.params.search.value=t.innerText),window.location.href="https://www.google.com/#q="+CNT.params.search.value,ga("send","event","general","search");else if(255!==e.keyCode){var n=CNT.params.search.value.trim();if(""===n)CNT.params.suggest.innerText="",CNT.params.suggest.style.display="none";else{var i="http://suggestqueries.google.com/complete/search?client=firefox&q="+n;CNT.promiseXHR("GET",i).then(function(e){var t=JSON.parse(e.responseText);CNT.params.suggest.innerText="",CNT.params.suggest.style.display="block";for(var a in t[1]){var n=document.createElement("li");n.classList.add("search-suggest-item"),n.innerText=t[1][a],CNT.params.suggest.appendChild(n)}})}}}},size:function(){var e="";e="disabled"===this.settings.generalHeaderType.value?"header-disabled":"small"===this.settings.generalHeaderType.value?"header-small":"header-normal",CNT.params.html.classList.contains(e)===!1&&(CNT.params.html.classList.remove("header-disabled"),CNT.params.html.classList.remove("header-small"),CNT.params.html.classList.remove("header-normal"),CNT.params.html.classList.add(e))},suggest:function(){CNT.params.suggest.style.display="none",CNT.params.search.removeEventListener("keyup",this.searchKeyupListener),CNT.params.search.addEventListener("keyup",this.searchKeyupListener),CNT.params.suggest.removeEventListener("click",this.searchClickListener),CNT.params.suggest.addEventListener("click",this.searchClickListener),CNT.params.search.removeEventListener("blur",this.searchBlurListener),CNT.params.search.addEventListener("blur",this.searchBlurListener)},okGoogle:function(){var e=CNT.icon("microphone-outline","search-field-voice");document.querySelector(".search-field").appendChild(e);var t=null;try{t=new SpeechRecognition}catch(a){t=new webkitSpeechRecognition}t.continuous=!0,t.interimResults=!0,t.lang=navigator.language,t.onend=function(){CNT.iconUpdate(e,"microphone-outline")},t.onstart=function(){CNT.iconUpdate(e,"microphone")},t.onresult=function(e){for(var t="",a=!1,n=0;n<e.results.length;n++){a=a||e.results[n].isFinal;for(var i=0;i<e.results[n].length;i++)t+=e.results[n][i].transcript}a?window.location.href="https://www.google.com/#q="+t:CNT.params.search.value=t},e.addEventListener("click",function(){t.start()})}},CNT.addPlugin({id:"gmail",icon:"gmail",resizable:!0,settings:{},params:{meUrl:"https://www.googleapis.com/gmail/v1/users/me",gmailUrl:"https://mail.google.com/mail/"},scopes:["https://www.googleapis.com/auth/gmail.modify","https://mail.google.com/"],title:chrome.i18n.getMessage("gmail"),_doArchiveItem:function(e){e.preventDefault(),CNT.promiseAuth(!1,CNT.plugin.gmail.scopes).then(function(e){var t=CNT.plugin.gmail.params.meUrl+"/messages/"+this.getAttribute("data-mid")+"/modify",a=this.closest("x-card-item");return a.parentNode.removeChild(a),localStorage.removeItem("gmailTime"),ga("send","event","gmail","archive"),CNT.promiseXHR("POST",t,[{key:"Authorization",value:"Bearer "+e},{key:"Content-Type",value:"application/json"}],'{removeLabelIds: ["INBOX"]}').then(function(){CNT.card.refresh("gmail")})}.bind(this))},_doDeleteItem:function(e){e.preventDefault(),CNT.promiseAuth(!1,CNT.plugin.gmail.scopes).then(function(e){var t=CNT.plugin.gmail.params.meUrl+"/messages/"+this.getAttribute("data-mid")+"/trash",a=this.closest("x-card-item");return a.parentNode.removeChild(a),localStorage.removeItem("gmailTime"),ga("send","event","gmail","trash"),CNT.promiseXHR("POST",t,[{key:"Authorization",value:"Bearer "+e}]).then(function(){CNT.card.refresh("gmail")})}.bind(this))},_drawItem:function(e,t){var a=this.params.gmailUrl+"?authuser="+localStorage.getItem("gmailAddress")+"#all/"+t.id,n=document.createElement("x-card-item-icon");n.setAttribute("icon","delete"),n.setAttribute("data-mid",t.id),n.addEventListener("click",this._doDeleteItem);var i=document.createElement("x-card-item-icon");i.setAttribute("icon","archive"),i.setAttribute("data-mid",t.id),i.addEventListener("click",this._doArchiveItem);var r=document.createElement("x-card-item");return r.innerText=t.subject,r.appendChild(n),r.appendChild(i),r.setAttribute("detail",t.from+" - "+CNT.prettyDate(t.date.toString())),r.setAttribute("href",a),r.addEventListener("click",function(){ga("send","event","gmail","launchGmail")}),CNT.card.appendContent("gmail",r)},_drawItemsFromCache:function(){var e=[],t=JSON.parse(localStorage.getItem("gmailData")||"{}");if(0===t.length)return CNT.card.notice("gmail",chrome.i18n.getMessage("nocontent")),Promise.resolve();t=t.slice(0,CNT.general.settings.generalListSize.value);for(var a in t)e.push(CNT.plugin.gmail._drawItem(a,t[a]));return Promise.all(e)},_drawTitle:function(e){return null===localStorage.getItem("gmailAddress")?CNT.promiseXHR("GET",this.params.meUrl+"/profile",[{key:"Authorization",value:"Bearer "+e}]).then(function(e){localStorage.setItem("gmailAddress",JSON.parse(e.responseText).emailAddress),this.drawTitle()}.bind(this)):(CNT.card.setTitleUrl(this.id,this.params.gmailUrl+"?authuser="+localStorage.getItem("gmailAddress")),Promise.resolve())},_getInbox:function(e){var t=this.params.meUrl+"/messages?maxResults=15";return t+="&q=-in:chats+in:inbox",CNT.promiseXHR("GET",t,[{key:"Authorization",value:"Bearer "+e}]).then(this._getMessages.bind(this,e)).then(this._parseMessages.bind(this)).then(function(e){return localStorage.setItem("gmailData",JSON.stringify(e)),localStorage.setItem("gmailTime",(new Date).getTime()),CNT.card.clearContent("gmail")}).then(this._drawItemsFromCache.bind(this))},_getMessages:function(e,t){var a=JSON.parse(t.responseText),n=[];for(var i in a.messages){var r=this.params.meUrl+"/messages/"+a.messages[i].id;n.push(CNT.promiseXHR("GET",r,[{key:"Authorization",value:"Bearer "+e}]))}return Promise.all(n)},_parseMessages:function(e){for(var t=[],a=0;a<e.length;a++){for(var n=JSON.parse(e[a].responseText),i={id:n.id,snippet:n.snippet},r=0;r<n.payload.headers.length;r++)if("From"===n.payload.headers[r].name){var s=n.payload.headers[r].value,o=s.match(/("?([^"]+)"?\s*)?<([^>]+)>/);null===o?i.from=s:"undefined"==typeof o[2]?i.from=o[4]:i.from=o[2]}else"Date"===n.payload.headers[r].name?i.date=n.payload.headers[r].value:"Subject"===n.payload.headers[r].name&&(i.subject=n.payload.headers[r].value);t.push(i)}return Promise.resolve(t)},draw:function(){var e=this;return CNT.promiseAuth(!1,this.scopes).then(function(t){return this._drawTitle(t),(new Date).getTime()-localStorage.getItem("gmailTime")>3e5?e._getInbox(t):Promise.reject()}.bind(this))["catch"](function(t){return!t||t instanceof XMLHttpRequest?CNT.card.clearContent("gmail").then(e._drawItemsFromCache.bind(e)):e.getConnectButton()})},init:function(){this.draw()},getConnectButton:function(){var e=document.createElement("x-button");e.innerText=chrome.i18n.getMessage("request_access"),e.addEventListener("click",function(){CNT.promiseAuth(!0,this.scopes).then(this.draw.bind(this))}.bind(this)),CNT.card.clearContent("gmail"),CNT.card.appendContent("gmail",e)}}),CNT.addPlugin({id:"news",icon:"newspaper",resizable:!0,params:{},settings:{newsLanguage:{"default":[navigator.language.toLocaleLowerCase(),navigator.language.toLocaleLowerCase().split("_")[0],"en"],description:chrome.i18n.getMessage("newsLanguage"),values:["es_ar","au","nl_be","fr_be","en_bw","pt-BR_br","ca","fr_ca","cs_cz","es_cl","es_co","es_cu","de","es","es_us","en_et","fr","en_gh","in","en_ie","en_il","it","en_ke","hu_hu","en_my","fr_ma","es_mx","en_na","nl_nl","nz","en_ng","no_no","de_at","en_pk","es_pe","en_ph","pl_pl","pt-PT_pt","de_ch","fr_sn","en_sg","en_za","fr_ch","sv_se","en_tz","tr_tr","uk","us","en_ug","es_ve","vi_vn","en_zw","el_gr","ru_ru","sr_rs","ru_ua","uk_ua","iw_il","ar_ae","ar_sa","ar_me","ar_lb","ar_eg","hi_in","ta_in","te_in","ml_in","kr","cn","tw","jp","hk"],valuesPrefix:"language"}},title:chrome.i18n.getMessage("news"),titleUrl:"http://news.google.com/",_drawItem:function(e){var t=document.createElement("x-card-item");return t.innerText=e.title,t.setAttribute("image","large"),t.setAttribute("line",2),t.setAttribute("detail",e.source),t.setAttribute("href",e.href),t.addEventListener("click",function(){ga("send","event","news","launchNews")}),e.src&&t.setAttribute("src",e.src),CNT.card.appendContent("news",t)},_drawItems:function(){var e=JSON.parse(localStorage.getItem("newsData"));if(0===e.length)return CNT.card.notice("news",chrome.i18n.getMessage("nocontent")),Promise.resolve();e=e.slice(0,CNT.general.settings.generalListSize.value);var t=e.map(function(e){return this._drawItem(e)},this);return Promise.all(t)},_getData:function(){var e="https://news.google.com/news?cf=all&hl="+this.settings.newsLanguage.value;return e+="&ned="+this.settings.newsLanguage.value+"&output=rss&pz=1&topic=h",e+="&num=15",CNT.promiseXHR("GET",e,[{key:"overrideMimeType",value:"text/xml"}])},_parseData:function(e){for(var t=[],a=e.responseXML.querySelectorAll("item"),n=0;n<a.length;n++){var i=a[n].querySelectorAll("description")[0].textContent,r=(new DOMParser).parseFromString(i,"text/xml"),s=r.querySelectorAll("img")[0],o=a[n].querySelectorAll("title")[0].textContent.split(" - "),c={href:a[n].querySelectorAll("link")[0].textContent,source:o.pop(),title:o.join(" - ")};s&&s.hasAttribute("src")&&(c.src="http:"+s.getAttribute("src")),t.push(c)}return localStorage.setItem("newsData",JSON.stringify(t)),localStorage.setItem("newsTime",(new Date).getTime()),t},draw:function(){var e=Promise.resolve();return((new Date).getTime()-localStorage.getItem("newsTime")>3e5||this.forceDraw===!0)&&(e=e.then(this._getData.bind(this)).then(this._parseData.bind(this))),e.then(CNT.card.clearContent.bind(CNT.card,"news")).then(this._drawItems.bind(this))["catch"](function(){CNT.card.notice("news",chrome.i18n.getMessage("nocontent"))})},init:function(){this.draw()}}),CNT.addPlugin({id:"recent",icon:"backup-restore",resizable:!0,params:{},settings:{},title:chrome.i18n.getMessage("recent"),titleUrl:"chrome://history/",_drawItem:function(e){var t=document.createElement("x-card-item");return t.innerText=e.title||e.url,t.setAttribute("detail",e.url),t.setAttribute("href",e.url),t.setAttribute("image","small"),t.setAttribute("src","chrome://favicon/"+e.url),t.addEventListener("click",function(){ga("send","event","recent","launchRecent")}),CNT.card.appendContent("recent",t)},_getData:function(){return new Promise(function(e){chrome.history.search({text:"",maxResults:parseInt(CNT.general.settings.generalListSize.value)},e)})},content:function(e){return 0===e.length?(CNT.card.notice("recent",chrome.i18n.getMessage("nocontent")),Promise.resolve()):Promise.all(e.map(function(e){return this._drawItem(e)},this))},draw:function(){return CNT.card.clearContent("recent").then(this._getData).then(this.content.bind(this))},init:function(){CNT.askPermission("recent",["history"]).then(this.draw.bind(this),function(){CNT.card.addError("recent",chrome.i18n.getMessage("error_occurs"))})}}),CNT.addPlugin({id:"support",icon:"wallet-giftcard",resizable:!1,params:{},settings:{supportCustom:{description:chrome.i18n.getMessage("paypal_make_a_donation"),"default":chrome.i18n.getMessage("paypal_help_dev"),custom:function(e,t){CNT.plugin.support.drawOption(t),t.parentNode.classList.add("support__custom-option")}}},title:chrome.i18n.getMessage("support"),drawOption:function(e){e.innerText="";var t=document.createElement("input");t.type="hidden",t.name="cmd",t.value="_s-xclick";var a=document.createElement("input");a.type="hidden",a.name="encrypted",a.value="-----BEGIN PKCS7-----MIIHNwYJKoZIhvcNAQcEoIIHKDCCByQCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYAcDWOyrwwiqVNnmo7p3HKiZgHUCGna35PpikVvxIieQspS5vnc0Uab8Efrgteu91kB7xm59u6t+zWHYmsUc37UlReixDAexamRxww4zh7HHn+s38w2S7WRK1T0yCA0Cv+BsjioF3AkRj3NC+2LeT5EJrHE7kwNl7fL1INZQEkFFjELMAkGBSsOAwIaBQAwgbQGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIOBn/9B6z85yAgZCyViOo1wlqg3UlRDojBaw+g9cVWv2xLChMBXcJk5xSh0Pykzckv6ofpK5prhyXqRuJtq7I9BYq89JfSCcn6RRSp6nfI11bdxcI3TOK5ffwyZmY8Rt/YFqGyA7JDdWpWkBU/SeJb8GuwFADBuxacoRl6iXp6nWpEgzZ0GS3uaGusJwfOyiJ/6GzjuBHo424m0KgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xMzA5MTIyMTQ2MzVaMCMGCSqGSIb3DQEJBDEWBBTw4MEhBjtVPSIAutQMrO+E+dLq7zANBgkqhkiG9w0BAQEFAASBgDfgCQguoq/veElyYY6x4pZXQPQs2RuEMQkrEyBeHFXYSVet1LE2nspejRyctRFKuk9+hHDhrVoISFSJiLA17S6INAQbuquwVIIx1MS8hzeiBs6/K9T7EEVZBMnwywE87rGan6GVm7EBoSaREpUtN6q4+RV7wTEMvf1TDsVAEibh-----END PKCS7-----";var n=document.createElement("img");n.alt="",n.border="0",n.src="https://www.paypalobjects.com/fr_FR/i/scr/pixel.gif",n.width="1",n.height="1",n.style.display="none";var i=document.createElement("input");i.type="image",i.src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif",i.border="0",i.name="submit",i.alt=chrome.i18n.getMessage("paypal_legend"),i.style.display="block",i.style.margin="auto";var r=document.createElement("div");r.classList.add("legend"),r.innerText=chrome.i18n.getMessage("paypal_buy_me_coffee");var s=document.createElement("div");s.classList.add("form__type-label"),s.appendChild(r);var o=document.createElement("form");o.action="https://www.paypal.com/cgi-bin/webscr",o.method="post",o.target="_top",o.appendChild(s),o.appendChild(t),o.appendChild(a),o.appendChild(i),o.appendChild(n),e.appendChild(o)},init:function(){}}),CNT.addPlugin({id:"topsites",icon:"trending-up",resizable:!0,reset:["topsitesExclusion"],params:{},scopes:["topSites"],settings:{},title:chrome.i18n.getMessage("topsites"),_deleteListener:function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=[];localStorage.hasOwnProperty("topsitesExclusion")&&(t=localStorage.getItem("topsitesExclusion").split(";")),t.push(this.getAttribute("url")),localStorage.setItem("topsitesExclusion",t.join(";")),this.parentNode.parentNode.removeChild(this.parentNode),CNT.plugin.topsites.draw(),ga("send","event","topsites","trash")},_drawItem:function(e){var t=document.createElement("x-card-item-icon");t.setAttribute("icon","delete"),t.setAttribute("url",e.url),t.addEventListener("click",this._deleteListener);var a=document.createElement("x-card-item");a.innerText=e.title,a.appendChild(t),a.setAttribute("detail",e.url),a.setAttribute("href",e.url),a.setAttribute("image","small"),a.setAttribute("src","chrome://favicon/"+e.url),a.addEventListener("click",function(){ga("send","event","topsites","launchTopsites")}),CNT.card.appendContent("topsites",a)},_drawItems:function(e){return 0===e.length?(CNT.card.notice("topsites",chrome.i18n.getMessage("nocontent")),Promise.resolve()):void e.forEach(this._drawItem.bind(this))},_parseData:function(e){var t=(localStorage.getItem("topsitesExclusion")||"").split(";");return e=e.filter(function(e){return-1===t.indexOf(e.url)}).slice(0,CNT.general.settings.generalListSize.value),Promise.resolve(e)},draw:function(){chrome.topSites.get(function(e){CNT.card.clearContent("topsites").then(this._parseData.bind(this,e)).then(this._drawItems.bind(this))}.bind(this))},init:function(){CNT.askPermission("topsites",["topSites"]).then(this.draw.bind(this),function(){CNT.card.addError("topsites",chrome.i18n.getMessage("error_occurs"))})}}),CNT.addPlugin({id:"weather",icon:"weather-partlycloudy",resizable:!1,params:{},settings:{weatherUnit:{"default":"",description:chrome.i18n.getMessage("weatherUnit"),values:["c","f"],valuesPrefix:"temperature"},weatherWoeid:{description:chrome.i18n.getMessage("overload_location"),clickable:!0,custom:function(e,t){return e.innerText="",t.innerText=chrome.i18n.getMessage("disabledTechnical"),void t.addEventListener("click",function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()})}}},title:chrome.i18n.getMessage("weather"),_drawItem:function(e){var t=document.createElement("span"),a=document.createElement("span"),n=document.createElement("span"),i=document.createElement("img"),r=document.createElement("span"),s=document.createElement("span");return t.classList.add("weather"),a.classList.add("weather-day"),n.classList.add("weather-icon"),r.classList.add("weather-high"),s.classList.add("weather-low"),a.innerText=e.day,i.src="image/"+this._getImage(e.code)+".png",i.height="40",i.width="40",n.appendChild(i),r.innerHTML=e.high+"&deg;",s.innerHTML=e.low+"&deg;",t.appendChild(a),t.appendChild(n),t.appendChild(r),t.appendChild(s),CNT.card.appendContent("weather",t)},_drawItems:function(){return CNT.card.setTitle("weather",localStorage.getItem("weatherTitle")),CNT.card.clearContent("weather").then(function(){var e=JSON.parse(localStorage.getItem("weatherData"))||[];return Promise.all(e.map(function(e){return this._drawItem(e)}.bind(this)))}.bind(this))},_getForecast:function(e,t){var a=["en-BS","en-BZ","en-KY","en-PW","en-US","en-AS","en-VI"],n="f1caa8e640b9ab6a8a7307ec9a69d10d",i="APPID="+n;i+="c"===localStorage.getItem("weatherUnit")||null===localStorage.getItem("weatherUnit")&&-1===a.indexOf(navigator.language)?"&units=metric":"&units=imperial",i+=t?"&lat="+e+"&lon="+t:"&id="+e;var r="http://api.openweathermap.org/data/2.5/forecast/daily?"+i+"&cnt=5&mode=json";return CNT.promiseXHR("GET",r,[{key:"overrideMimeType",value:"text/xml"}])},_getImage:function(e){switch(e){case"01d":case"01n":return"clear";case"02d":case"02n":return"fair";case"03d":case"03n":return"default_weather_icon";case"04d":case"04n":return"cloudy";case"09d":case"09n":return"freezing rain";case"10d":case"10n":return"showers";case"11d":case"11n":return"thunderstorms";case"13d":case"13n":return"snow";case"50d":case"50n":return"smoky";default:return"no weather"}},_parseData:function(e){var t=JSON.parse(e.responseText),a=t.list.map(function(e){return{day:new Date(1e3*e.dt).toLocaleString(CNT.plugin.datetime.settings.datetimeLanguage.value,{weekday:"short"}),code:e.weather[0].icon,high:Math.round(e.temp.max),low:Math.round(e.temp.min)}});return localStorage.setItem("weatherData",JSON.stringify(a)),localStorage.setItem("weatherTitle",t.city.name),localStorage.setItem("weatherTime",(new Date).getTime()),Promise.resolve()},draw:function(){(new Date).getTime()-localStorage.getItem("weatherTime")>216e5||this.forceDraw===!0?navigator.geolocation.getCurrentPosition(function(e){this._getForecast(e.coords.latitude,e.coords.longitude).then(this._parseData.bind(this)).then(this._drawItems.bind(this))["catch"](function(){localStorage.getItem("weatherHtml")?(CNT.card.addNotice("weather",chrome.i18n.getMessage("noconnection")),CNT.card.appendContent("weather",localStorage.getItem("weatherHtml")),CNT.card.setTitle("weather",localStorage.getItem("weatherTitle"))):CNT.card.addNotice("weather",chrome.i18n.getMessage("nocontent"))})}.bind(this),function(){this._drawItems(),CNT.card.addNotice("weather",chrome.i18n.getMessage("nogeolocation"))}.bind(this)):this._drawItems()},init:function(){this.draw()}}),CNT.startAnalytics=function(){!function(e,t,a,n,i,r,s){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},CNT.general.settings.generalAnalytics.value&&(e[i].l=1*new Date,r=t.createElement(a),r.async=1,r.src=n,s=t.getElementsByTagName(a)[0],s.parentNode.insertBefore(r,s))}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-19771663-2","auto"),ga("set","checkProtocolTask",null)},CNT.loadStyle=function(){var e="newtab"===CNT.page?"newtab":"options",t="dark"===localStorage.getItem("generalTheme")?"dark":"light",a=document.createElement("link");a.rel="stylesheet",a.href="css/"+e+"-"+t+".css",a.onload=function(){document.body.style.opacity=1},document.head.appendChild(a)},CNT.loadStyle(),CNT.init(),function(){function e(){}var t=Object.create(HTMLElement.prototype),a=document.querySelector("#x-card-content")["import"].querySelector("template");t.createdCallback=function(){var t=document.importNode(a.content,!0);this.createShadowRoot(),e.call(this,this.shadowRoot),this.shadowRoot.appendChild(t)},t.attributeChangedCallback=function(){e.call(this)},document.registerElement("x-card-content",{prototype:t})}(),function(){function e(){this.hasAttribute("icon")&&this.shadowRoot.icon.setAttribute("xlink:href","#svgicon-"+this.getAttribute("icon")),this.hasAttribute("href")&&(this.shadowRoot.title.href=this.getAttribute("href")),this.hasAttribute("option")===!1&&(this.shadowRoot.iconDot.style.display="none")}var t="rd-card-header",a=Object.create(HTMLElement.prototype),n=document.querySelector("#x-card-header")["import"].querySelector("template");a.createdCallback=function(){var a=document.importNode(n.content,!0);this.createShadowRoot(),this.shadowRoot.icon=a.querySelector("."+t+"__icon use"),this.shadowRoot.title=a.querySelector("."+t+"__title"),this.shadowRoot.iconDot=a.querySelector("."+t+"__icon-dot"),this.shadowRoot.iconDot.addEventListener("click",function(){var e=new CustomEvent("option",{});this.dispatchEvent(e)}.bind(this)),e.call(this,this.shadowRoot),this.shadowRoot.appendChild(a)},a.attributeChangedCallback=function(){e.call(this)},document.registerElement("x-card-header",{prototype:a})}(),function(){function e(){this.hasAttribute("icon")&&this.shadowRoot.icon.setAttribute("xlink:href","#svgicon-"+this.getAttribute("icon"))}var t=Object.create(HTMLElement.prototype),a=document.querySelector("#x-card-item-icon")["import"].querySelector("template");t.createdCallback=function(){var t=document.importNode(a.content,!0);this.createShadowRoot(),this.shadowRoot.icon=t.querySelector("use"),e.call(this,this.shadowRoot),this.shadowRoot.appendChild(t)},t.attributeChangedCallback=function(){e.call(this)},document.registerElement("x-card-item-icon",{prototype:t})}(),function(){function e(){if(this.actionLength=Array.prototype.filter.call(this.querySelectorAll("x-card-item-icon"),function(e){return"X-CARD-ITEM-ICON"===e.tagName}).length,this.hasAttribute("href")&&(this.shadowRoot.item.href=this.getAttribute("href")),this.hasAttribute("detail")&&(this.shadowRoot.subtitle.textContent=this.getAttribute("detail")),this.hasAttribute("src")&&(this.shadowRoot.image.src=this.getAttribute("src")),this.hasAttribute("line")&&"2"===this.getAttribute("line")?this.shadowRoot.title.classList.add("rd-card-item__title--has-two-lines"):this.shadowRoot.title.classList.remove("rd-card-item__title--has-two-lines"),this.shadowRoot.item.classList.remove(".rd-card-item--has-action"),this.shadowRoot.item.classList.remove(".rd-card-item--has-two-action"),1===this.actionLength?this.shadowRoot.item.classList.add("rd-card-item--has-action"):2===this.actionLength&&this.shadowRoot.item.classList.add("rd-card-item--has-two-action"),this.hasAttribute("image")?(this.shadowRoot.image.classList.add("rd-card-item__image-"+this.getAttribute("image")),this.shadowRoot.image.style=""):this.shadowRoot.image.style="none",this.shadowRoot.title.textContent="",Array.prototype.slice.call(this.childNodes).forEach(function(e){3===e.nodeType&&(this.shadowRoot.title.textContent=e.textContent)},this),this.hasAttribute("tag")){var e=document.createElement("span");e.innerText=this.getAttribute("tag"),e.classList.add("rd-card-item__tag"),this.shadowRoot.subtitle.insertAdjacentElement("afterbegin",e)}}var t=Object.create(HTMLElement.prototype),a=document.querySelector("#x-card-item")["import"].querySelector("template");t.createdCallback=function(){var t=document.importNode(a.content,!0);this.createShadowRoot(),this.shadowRoot.item=t.querySelector("a"),this.shadowRoot.subtitle=t.querySelector(".rd-card-item__subtitle"),this.shadowRoot.image=t.querySelector(".rd-card-item__image"),this.shadowRoot.title=t.querySelector(".rd-card-item__title"),e.call(this),this.shadowRoot.appendChild(t)},t.attributeChangedCallback=function(){e.call(this)},document.registerElement("x-card-item",{prototype:t})}(),function(){function e(){this.hasAttribute("resizable")?(this.shadowRoot.resizer.style.display="",this.shadowRoot.card.classList.add("resizable")):(this.shadowRoot.resizer.style.display="none",this.shadowRoot.card.classList.remove("resizable")),this.hasAttribute("height")&&(this.shadowRoot.card.style.height=this.getAttribute("height")+"px")}var t="rd-card",a=Object.create(HTMLElement.prototype),n=document.querySelector("#x-card")["import"].querySelector("template");a.createdCallback=function(){var a=document.importNode(n.content,!0);this.createShadowRoot(),this.shadowRoot.card=a.querySelector("."+t),this.shadowRoot.resizer=a.querySelector("."+t+"__resizer"),this.shadowRoot.resizer.addEventListener("mousedown",function(e){var t=window.getComputedStyle(this.shadowRoot.card,null),a=parseInt(t.getPropertyValue("height")),n=e.pageY,i=!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var r=function(e){if(i===!0){var t=e.pageY,r=a+t-n;r>=219&&(this.shadowRoot.card.style.height=r+"px")}}.bind(this),s=function(){document.body.removeEventListener("mousemove",r),document.body.removeEventListener("mouseup",s),i=!1,ga("send","event",this.id,"resize"),localStorage.setItem(this.id+"Height",parseInt(this.shadowRoot.card.style.height))}.bind(this);document.body.addEventListener("mousemove",r),document.body.addEventListener("mouseup",s)}.bind(this)),e.call(this,this.shadowRoot),this.shadowRoot.appendChild(a)},a.attributeChangedCallback=function(){e.call(this)},document.registerElement("x-card",{prototype:a})}(),function(){function e(){this.hasAttribute("error")?this.shadowRoot.notice.classList.add("error"):this.shadowRoot.notice.classList.remove("error"),this.hasAttribute("notice")?this.shadowRoot.notice.classList.add("notice"):this.shadowRoot.notice.classList.remove("notice")}var t="rd-notice",a=Object.create(HTMLElement.prototype),n=document.querySelector("#x-notice")["import"].querySelector("template");a.createdCallback=function(){var a=document.importNode(n.content,!0);this.createShadowRoot(),this.shadowRoot.notice=a.querySelector("."+t),e.call(this,this.shadowRoot),this.shadowRoot.appendChild(a)},a.attributeChangedCallback=function(){e.call(this)},document.registerElement("x-notice",{prototype:a})}();