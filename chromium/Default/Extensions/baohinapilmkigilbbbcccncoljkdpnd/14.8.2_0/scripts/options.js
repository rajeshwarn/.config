var _gaq=window._gaq||[];!function(){"use strict";function e(e,t){var n;return chrome&&chrome.i18n&&(n=chrome.i18n.getMessage(e)),n||t||"placeholder"}function t(e,t){return parseInt(e,10)>parseInt(t,10)?-1:1}function n(e,t){var n,s=parseInt(e,10),a=parseInt(t,10);s>1e3?n=-1*s:(n=mostPopularServices.indexOf(s),-1===n&&(n=1e3));var i;if(a>1e3?i=-1*a:(i=mostPopularServices.indexOf(a),-1===i&&(i=1e3)),i>n)return-1;if(n>i)return 1;var o=servicesDatabase[e].name.toLowerCase(),c=servicesDatabase[t].name.toLowerCase();return c>o?-1:o>c?1:0}function s(e,t){var n=parseInt(e,10),s=parseInt(t,10),a=servicesDatabase[e].name.toLowerCase(),i=servicesDatabase[t].name.toLowerCase();return n>1e3&&1e3>s?-1:1e3>n&&s>1e3?1:n>1e3&&s>1e3?i>a?-1:a>i?1:0:i>a?-1:a>i?1:0}function a(e,t){document.getElementById(e).classList.toggle("on","on"===t)}function i(e){var t=parseInt(this.parentNode.parentNode.id,10);document.getElementById("custom-name").value=servicesDatabase[t].name,document.getElementById("custom-url").value=servicesDatabase[t].url,document.getElementById("custom-tooltip").value=servicesDatabase[t].tooltip;var n=servicesDatabase[t].iconUrl;"string"==typeof n&&n.length>0&&(document.getElementById("custom-icon-url").value=n),document.getElementById("customButtonPopup").dataset.service=t,a("customButtonPopup","on"),e.stopPropagation()}function o(){var e=[];[].forEach.call(document.getElementById("rightList").children,function(t){e.push(parseInt(t.id,10))}),cjExtensions.settings.set("userList",e)}function c(e){var t=-1!==badgeOnLeftIcons.indexOf(e.name),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox","0 0 32 32"),n.setAttribute("class","cj-al-badge"),n.style.height="32px",n.style.width="32px";var s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("transform","translate("+(t?"1":"21")+", 21) scale(.5)"),n.appendChild(s);var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M10,21.1421356 C15.5228475,21.1421356 20,16.6649831 20,11.1421356 C20,5.61928813 0,5.61928813 0,11.1421356 C0,16.6649831 4.4771525,21.1421356 10,21.1421356 Z"),a.setAttribute("fill","rgba(0,0,0,.1)"),s.appendChild(a);var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M20,10 C20,15.5228 15.5228,20 10,20 C4.47715,20 0,15.5228 0,10 C0,4.47715 4.47715,0 10,0 C15.5228,0 20,4.47715 20,10 Z"),i.setAttribute("fill","#f5f5f5"),s.appendChild(i);var o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",serviceBadges[e.badge]),o.setAttribute("fill","rgba(0,0,0,.54)"),s.appendChild(o),n}function r(e){var t=document.createElement("div");if(e.badge&&e.badge in serviceBadges){var n=c(e);t.appendChild(n)}var s=document.createElement("img"),a=e.size||32,i=16===a?16:32;return e.custom&&16!==a&&s.addEventListener("load",function(){s.height<=e.originalSize*(7/8)&&t.classList.add("service-icon-box")}),e.tooltip&&(s.title=e.tooltip),e.url?(s.src=e.url,s.height=a,s.width=a,t.appendChild(s)):(s.height=a,s.width=a,s.src="/images/"+i+"/"+(e.name||"placeholder")+"_"+i+"dp.svg",t.appendChild(s)),t}function d(e){var t=parseInt(this.parentNode.parentNode.id,10);document.getElementById("removeButtonPopup").dataset.service=t,a("removeButtonPopup","on"),e.stopPropagation()}function u(t){var n=servicesDatabase[t],s=document.createElement("li");s.className="service-item",s.setAttribute("draggable",!0),s.addEventListener("dragstart",function(e){e.dataTransfer.setData("text",e.target.id+","+e.target.parentNode.id)}),s.addEventListener("click",function(){document.getElementById("leftList"===s.parentNode.id?"rightList":"leftList").appendChild(s),o()}),s.id=t,s.setAttribute("title",n.tooltip);var a=r({size:32,badge:n.badge,name:n.icon,url:n.custom?n.iconUrl||"http://www.google.com/s2/favicons?domain_url="+n.url:null,custom:n.custom,originalSize:32});a.classList.add("service-icon"),s.appendChild(a);var c=document.createElement("div");if(c.className="service-label",c.textContent=e(n.i18n,n.name),s.appendChild(c),n.custom){var u=document.createElement("div");u.classList.add("service-tools");var l=document.createElement("img");l.classList.add("editButton"),l.addEventListener("click",i),l.setAttribute("title","Edit Service"),l.setAttribute("src","images/options/edit.png"),u.appendChild(l);var m=document.createElement("img");m.classList.add("removeButton"),m.addEventListener("click",d),m.setAttribute("title","Delete Service"),m.setAttribute("src","images/options/delete-icon.png"),u.appendChild(m),s.appendChild(u)}return s}function l(){cjExtensions.settings.get(["customServicesDatabase","userList"]).then(function(e){var a,i=e.userList;for(a in e.customServicesDatabase)servicesDatabase[a]=e.customServicesDatabase[a],servicesDatabase[a].custom=!0;var o=document.getElementById("rightList"),c=document.getElementById("leftList");o.innerText="",c.innerText="";var r=[];for(a in servicesDatabase)console.log(a),-1===i.indexOf(parseInt(a,10))&&r.push(a);i.forEach(function(e){e in servicesDatabase&&o.appendChild(u(e))});var d=document.getElementById("services-list-order").value,l={popularity:n,alphabetically:s,newest:t};r.sort(l[d]),r.forEach(function(e){c.appendChild(u(e))})})}function m(e,t,n){var s=new FileReader;s.addEventListener("load",function(e){try{t(JSON.parse(e.currentTarget.result))}catch(s){n&&n(s)}}),s.readAsText(e)}function g(e){cjExtensions.settings.clear(),cjExtensions.settings.set(e),a("importSuccessPopup","on")}function v(e){document.getElementById("importError").textContent=e,a("importFailPopup","on")}function p(e){m(e.target.files[0],g,v)}function f(e){var t=e.dataTransfer.getData("Text").split(","),n=t[1];if("leftList"!==n||"leftList"!==e.target.id&&"leftList"!==e.target.parentNode.id){e.preventDefault();var s=t[0],a=document.getElementById(s);if("UL"===e.target.tagName)e.target.appendChild(a);else{var i=e.target.parentNode;"leftList"===i.id?i.appendChild(a):(e.offsetY<=22?i.insertBefore(a,e.target):i.insertBefore(a,e.target.nextSibling),i.insertBefore(a,event.offsetY<=22?e.target:e.target.nextSibling))}o()}}function E(e){return e.sort(function(e,t){return servicesDatabase[e].name.toLowerCase()<servicesDatabase[t].name.toLowerCase()?-1:servicesDatabase[e].name.toLowerCase()>servicesDatabase[t].name.toLowerCase()?1:0})}function h(e,t){var n=e.indexOf(t);return e.splice(n,1),e}function b(e){var t=new Blob([JSON.stringify(e)],{type:"text/plain"}),n=document.createElement("a");n.setAttribute("download","shortcutsForGoogleSettings.json"),n.setAttribute("href",window.URL.createObjectURL(t)),n.textContent="Download",n.click()}function L(){-1!==location.search.indexOf("standalone=1")&&document.body.classList.add("standalone"),chrome.tabs.getCurrent(function(e){document.body.classList.toggle("standalone","undefined"!=typeof e)}),l(),cjExtensions.settings.get(null).then(function(e){var t=e;t&&t.userList||(t=defaultSettings),Object.keys(t.customServicesDatabase).forEach(function(e){servicesDatabase[e]=t.customServicesDatabase[e],servicesDatabase[e].custom=!0});var n=document.getElementById("services-list-order");n.addEventListener("change",l);var s=document.getElementById("show-settings");s.checked=t.showSettings,s.addEventListener("click",function(){cjExtensions.settings.set("showSettings",s.checked)});var i=document.getElementById("hide-tooltip");i.checked=t.hideTooltip,i.addEventListener("click",function(){cjExtensions.settings.set("hideTooltip",i.checked)});var o=document.getElementById("show-launchbox");o.checked=t.showLaunchbox,o.addEventListener("click",function(){cjExtensions.settings.set("showLaunchbox",o.checked)});var c=document.getElementById("column-count"),r=document.getElementById("column-count-input");r.value=t.iconBreak,r.addEventListener("keyup",function(){isNaN(parseInt(r.value,10))?cjExtensions.settings.remove("iconBreak"):cjExtensions.settings.set("iconBreak",parseInt(r.value,10))});var d=document.getElementById("display-mode");d.value=t.displayMode?t.displayMode:"grid","custom"===d.value&&c.classList.add("on"),d.addEventListener("change",function(){c.classList.toggle("on","custom"===d.value),cjExtensions.settings.set("displayMode",d.value)});var u=document.getElementById("hide-label");u.checked=t.hideLabel,u.addEventListener("click",function(){cjExtensions.settings.set("hideLabel",u.checked)});var m=document.getElementById("allow-analytics");m.checked="true"!==localStorage.getItem("disableAnalytics"),m.addEventListener("click",function(){localStorage.setItem("disableAnalytics",!m.checked)});var g=document.getElementById("always-tab");g.checked=t.alwaysTab,g.addEventListener("click",function(){cjExtensions.settings.set("alwaysTab",g.checked)});var v=document.getElementById("no-focus-tab");v.checked=t.noFocusTab,v.addEventListener("click",function(){cjExtensions.settings.set("noFocusTab",v.checked)});var L=[["default","app_launcher_square","original","gsa_blue_square","gsa_blue_circle"],["default_blue","app_launcher_blue","original_blue","gsa_blue","gsa"],["default_grey","app_launcher","original_grey","gsa_grey","gsa_nobg"]],I=document.getElementById("toolbarIcons");L.forEach(function(e){e.forEach(function(e){var t=document.createElement("img");t.addEventListener("click",function(){cjExtensions.settings.set("toolbarIcon",e),chrome.browserAction.setIcon({path:{19:"images/toolbar/"+e+"-19.png",38:"images/toolbar/"+e+"-38.png"}})}),t.src="images/toolbar/"+e+"-"+(y?"76":"38")+".png",I.appendChild(t)}),I.appendChild(document.createElement("br"))});var B=document.getElementById("iconSizes").getElementsByTagName("img"),w=t.shortcutIconSize||64;document.querySelector('#iconSizes>img[data-size="'+w+'"]').classList.add("on");for(var S=B.length;S--;S>0)B[S].addEventListener("click",function(){document.querySelector("#iconSizes > img.on").classList.remove("on"),this.classList.add("on"),cjExtensions.settings.set("shortcutIconSize",parseInt(this.dataset.size,10))});var x=document.getElementById("btnReset");x.addEventListener("click",function(){a("resetSettingsPopup","on")});var k=document.getElementById("btnSuggest");k.addEventListener("click",function(){document.querySelector("#suggestPopup iframe").setAttribute("src","https://docs.google.com/forms/d/1IK19_gy-LVegpR1jsBXCc-WfM7eeD0ZPOWXIo2Sq8Ng/viewform"),a("suggestPopup","on")});var D=document.getElementById("btnSelectAllServices");D.addEventListener("click",function(){var e=[];[].forEach.call(document.querySelectorAll(".service-container > .service-item"),function(t){e.push(parseInt(t.id,10))}),cjExtensions.settings.set("userList",e).then(l)});var C=document.getElementById("btnDeselectAllServices");C.addEventListener("click",function(){cjExtensions.settings.set("userList",[]).then(l)});var j=document.getElementById("rightList"),A=document.getElementById("leftList");j.addEventListener("drop",f),j.addEventListener("dragover",function(e){e.preventDefault()}),A.addEventListener("drop",f),A.addEventListener("dragover",function(e){e.preventDefault()}),document.getElementById("btnSaveModifiedService").addEventListener("click",function(){var e=parseInt(document.getElementById("customButtonPopup").dataset.service,10);e&&cjExtensions.settings.get(["customServicesDatabase","userList"]).then(function(t){var n=t.customServicesDatabase;n||(n={}),n[e]||(n[e]={}),n[e].name=document.getElementById("custom-name").value,n[e].url=document.getElementById("custom-url").value,n[e].tooltip=document.getElementById("custom-tooltip").value;var s=document.getElementById("custom-icon-url").value;n[e].iconUrl=""!=s?s:void 0,cjExtensions.settings.set("customServicesDatabase",n);var a=t.userList;-1===a.indexOf(e)&&(a.push(e),cjExtensions.settings.set("userList",a));for(var i in n)servicesDatabase[i]=n[i],servicesDatabase[i].custom=!0;l()})}),[].forEach.call(document.getElementsByClassName("buttonClosePopup"),function(e){e.addEventListener("click",function(){a(this.dataset.popup,"off")})}),document.getElementById("btnRemoveCustomService").addEventListener("click",function(){var e=parseInt(document.getElementById("removeButtonPopup").dataset.service,10);cjExtensions.settings.get(["customServicesDatabase","userList"]).then(function(t){var n=t.customServicesDatabase;n[e]&&delete n[e],cjExtensions.settings.set("customServicesDatabase",n);var s=t.userList;-1!==s.indexOf(e)&&(s=h(s,e),cjExtensions.settings.set("userList",s)),l()})}),document.getElementById("btnAddCustomButton").addEventListener("click",function(){document.getElementById("customButtonPopup").dataset.service=(new Date).getTime(),a("customButtonPopup","on"),document.getElementById("custom-name").value="",document.getElementById("custom-url").value="",document.getElementById("custom-tooltip").value="",document.getElementById("custom-icon-url").value=""}),document.getElementById("btnResetAllSettings").addEventListener("click",function(){cjExtensions.settings.clear(),cjExtensions.settings.set(defaultSettings),window.location.reload()}),document.getElementById("btnSortUserList").addEventListener("click",function(){cjExtensions.settings.get(["userList","customServicesDatabase"]).then(function(e){for(var t in e.customServicesDatabase)servicesDatabase[t]=e.customServicesDatabase[t],servicesDatabase[t].custom=!0;cjExtensions.settings.set("userList",E(e.userList)),l()})}),document.getElementById("servicesFilter").addEventListener("keyup",function(){for(var e=this.value.toLowerCase(),t=document.querySelectorAll("#rightList>li, #leftList>li"),n=0;n<t.length;n++){var s=t[n],a=s.textContent.toLowerCase();s.classList.toggle("hidden",-1===a.indexOf(e))}}),document.getElementById("btnImportAndExportSettings").addEventListener("click",function(){a("importAndExportPopup","on")}),document.getElementById("importButton").addEventListener("click",function(){var e=document.createElement("input");e.setAttribute("type","file"),e.addEventListener("change",function(e){p(e)}),e.click()}),document.getElementById("exportButton").addEventListener("click",function(){cjExtensions.settings.get(null).then(function(e){b(e)})}),document.getElementById("importSuccessReload").addEventListener("click",function(){location.reload()})})}_gaq.push(["_setAccount","UA-38514239-1"]),_gaq.push(["_trackPageview"]),_gaq.push(["_trackEvent","Options Opened","load"]),function(){if("true"!==localStorage.getItem("disableAnalytics")&&"baohinapilmkigilbbbcccncoljkdpnd"===chrome.runtime.id){var e=document.createElement("script");e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.querySelector("script");t.parentNode.insertBefore(e,t)}}();var y=window.devicePixelRatio>1;L()}();